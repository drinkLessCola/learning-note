# ç±»

## Class åŸºæœ¬è¯­æ³•

### â€œclassâ€è¯­æ³•

åŸºæœ¬è¯­æ³•æ˜¯ï¼š

```js
class MyClass{
	constructor(){ ... }
	method1(){ ... }
	method2(){ ... }
	method3(){ ... }
}
```

ç„¶åä½¿ç”¨ new MyClass()æ¥åˆ›å»ºå…·æœ‰ä¸Šè¿°åˆ—å‡ºçš„æ‰€æœ‰æ–¹æ³•çš„æ–°å¯¹è±¡ã€‚

**newä¼šè‡ªåŠ¨è°ƒç”¨==constructor()==æ–¹æ³•**ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨constructor()ä¸­åˆå§‹åŒ–å¯¹è±¡ã€‚

```js
class User{

	constructor(name){
		this.name = name;
	}
	
	sayHi(){
		alert(this.name);
	}
}

let user = new User("John");
user.sayHi();
```

å½“ **new User(â€œJohnâ€)** è¢«è°ƒç”¨ï¼š

1. ä¸€ä¸ªæ–°å¯¹è±¡è¢«åˆ›å»ºã€‚
2. constructorä½¿ç”¨ç»™å®šçš„å‚æ•°è¿è¡Œï¼Œå¹¶ä¸ºå…¶åˆ†é…this.nameã€‚

### class

åœ¨JavaScriptä¸­ï¼Œç±»æ˜¯ä¸€ç§å‡½æ•°ã€‚

**class User { â€¦ }** æ„é€ å®é™…ä¸Šåšäº†å¦‚ä¸‹çš„äº‹æƒ…ï¼š

1. åˆ›å»ºä¸€ä¸ªåä¸ºUserçš„**å‡½æ•°**ï¼Œè¯¥å‡½æ•°æˆä¸ºç±»å£°æ˜çš„ç»“æœã€‚è¯¥**å‡½æ•°çš„ä»£ç æ¥è‡ªäº==constructor==æ–¹æ³•** ï¼ˆå¦‚æœæˆ‘ä»¬ä¸ç¼–å†™è¿™ç§æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒå°±è¢«å‡å®šä¸ºç©ºï¼‰ã€‚
2. åœ¨**ç±»å.prototypeä¸­å­˜å‚¨ç±»ä¸­çš„æ–¹æ³•**ï¼Œä¾‹å¦‚**User.prototype**ä¸­çš„sayHiã€‚

å½“new Userå¯¹è±¡è¢«åˆ›å»ºåï¼Œå½“æˆ‘ä»¬è°ƒç”¨å…¶æ–¹æ³•æ—¶ï¼Œä¼šä»**==åŸå‹==**ä¸­è·å–å¯¹åº”çš„æ–¹æ³•ã€‚

~~<!--æ­¤å¤„çš„åŸå‹å¯èƒ½æŒ‡çš„æ˜¯ä¸Šé¢åˆ›å»ºçš„Functionçš„åŸå‹ï¼Ÿ-->~~

æˆ‘ä»¬å¯ä»¥å°†class Userå£°æ˜çš„ç»“æœè§£é‡Šä¸ºï¼š

![image-20211203180423086](C:\Users\Zirina\AppData\Roaming\Typora\typora-user-images\image-20211203180423086.png)

```js
class User {
	construtor(name)	{ this.name = name; }
	sayHi(){ alert(this.name); }
}
//classæ˜¯ä¸€ä¸ªå‡½æ•°
alert(typeof User); //function
//æ›´ç¡®åˆ‡è¯´ï¼Œæ˜¯construtoræ–¹æ³•
alert(User === User.prototype.construtor);//true
//æ–¹æ³•åœ¨User.prototypeä¸­
alert(User.prototype.sayHi); // alert(this.name);
//åœ¨åŸå‹ä¸­å®é™…ä¸Šæœ‰ä¸¤ä¸ªæ–¹æ³•
alert(Object.getOwnPropertyNames(User.prototype));// construtor,sayHi
```

### classä¸ä»…ä»…æ˜¯è¯­æ³•ç³–

è¯­æ³•ç³–æŒ‡ä½¿å†…å®¹æ›´æ˜“é˜…è¯»ï¼Œè€Œä¸å¼•å…¥ä»»ä½•æ–°å†…å®¹çš„è¯­æ³•ã€‚

å› ä¸ºæˆ‘ä»¬å®é™…ä¸Šå¯ä»¥åœ¨æ²¡æœ‰classçš„æƒ…å†µä¸‹å£°æ˜ç›¸åŒçš„å†…å®¹ã€‚

```js
Function User(name){
	this.name = name;
}
User.prototype.sayHi = function(){
	alert(this.name);
}

let user = new User("John");
user.sayHi();
```

ä½†å®ƒä»¬ä¹‹é—´å­˜åœ¨ç€é‡å¤§å·®å¼‚ï¼š

- **[[IsClassConstrutor]]å†…éƒ¨å±æ€§æ ‡è®°**

  - é€šè¿‡classåˆ›å»ºçš„å‡½æ•°å…·æœ‰ç‰¹æ®Šçš„å†…éƒ¨å±æ€§æ ‡è®°ï¼Œ**[[IsClassConstrutor]]:true**ã€‚å› æ­¤ï¼Œå®ƒä¸æ‰‹åŠ¨åˆ›å»ºå¹¶ä¸å®Œå…¨ç›¸åŒã€‚

  - ç¼–ç¨‹è¯­è¨€ä¼šåœ¨è®¸å¤šåœ°æ–¹æ£€æŸ¥è¯¥å±æ€§ã€‚é€šè¿‡classåˆ›å»ºçš„å‡½æ•°==**å¿…é¡»ä½¿ç”¨newæ¥è°ƒç”¨**==ã€‚

  - ```js
    class User{
    	construtor(){}
    }
    alert(typeof User);//function
    User();//Error:Class construtor User cannot be invoked without 'new'
    ```

  - æ­¤å¤–ï¼Œå¤§å¤šæ•°JavaScriptå¼•æ“ä¸­çš„ç±»æ„é€ å™¨çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼éƒ½ä»¥â€œclass..â€å¼€å¤´ã€‚

- **ç±»æ–¹æ³•ä¸å¯æšä¸¾ã€‚**

  - ç±»å®šä¹‰å°†**prototypeä¸­çš„æ‰€æœ‰æ–¹æ³•çš„enumerableæ ‡å¿—è®¾ç½®ä¸ºfalse**ã€‚
  - è¿™å¾ˆå¥½ï¼Œå› ä¸ºå¦‚æœæˆ‘ä»¬å¯¹ä¸€ä¸ªå¯¹è±¡è°ƒç”¨for..inæ–¹æ³•ï¼Œæˆ‘ä»¬é€šå¸¸ä¸å¸Œæœ›classæ–¹æ³•å‡ºç°ã€‚

- **ç±»æ€»æ˜¯ä½¿ç”¨use strictã€‚**

  - ç±»æ„é€ ä¸­çš„æ‰€æœ‰ä»£ç éƒ½å°†è‡ªåŠ¨è¿›å…¥ä¸¥æ ¼æ¨¡å¼ã€‚

### ç±»è¡¨è¾¾å¼

```js
let User = class{
	sayHi(){
		alert("Hello");
	}
}
```

ç±»ä¼¼äºå‘½åå‡½æ•°è¡¨è¾¾å¼ï¼ˆNamed Function Expressions)ï¼Œç±»è¡¨è¾¾å¼å¯èƒ½ä¹Ÿåº”è¯¥æœ‰ä¸€ä¸ªåå­—ã€‚

å¦‚æœç±»è¡¨è¾¾å¼æœ‰åå­—ï¼Œé‚£ä¹ˆè¯¥åå­—ä»…åœ¨ç±»å†…éƒ¨å¯è§ã€‚

```javascript
// â€œå‘½åç±»è¡¨è¾¾å¼ï¼ˆNamed Class Expressionï¼‰â€
// (è§„èŒƒä¸­æ²¡æœ‰è¿™æ ·çš„æœ¯è¯­ï¼Œä½†æ˜¯å®ƒå’Œå‘½åå‡½æ•°è¡¨è¾¾å¼ç±»ä¼¼)
let User = class MyClass {
  sayHi() {
    alert(MyClass); // MyClass è¿™ä¸ªåå­—ä»…åœ¨ç±»å†…éƒ¨å¯è§
  }
};

new User().sayHi(); // æ­£å¸¸è¿è¡Œï¼Œæ˜¾ç¤º MyClass ä¸­å®šä¹‰çš„å†…å®¹

alert(MyClass); // errorï¼ŒMyClass åœ¨å¤–éƒ¨ä¸å¯è§
```

æˆ‘ä»¬ç”šè‡³å¯ä»¥åŠ¨æ€åœ°â€œæŒ‰éœ€â€åˆ›å»ºç±»ï¼Œå°±åƒè¿™æ ·ï¼š

```js
function makeClass(phrase){
	return class{
		sayHi(){
			alert(phrase);
		}
	};
}

let User = makeClass("Hello");
new User().sayHi(); //Hello
```

> Function User(){}æ–¹æ³•ä½“ä¸ºç©ºï¼Œåœ¨User.prototypeä¸­ å­˜å‚¨äº†sayHi()æ–¹æ³•
>
> new User().\__proto__ == User.prototype

### Getters/setters

å°±åƒå¯¹è±¡å­—é¢é‡ï¼Œç±»å¯èƒ½åŒ…æ‹¬getters/settersï¼Œè®¡ç®—å±æ€§ï¼ˆcomputed properties)ç­‰ã€‚

è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨get/setå®ç°user.nameçš„å®ä¾‹ï¼š

```js
class User{
	construtor(name){
		//this.name = è°ƒç”¨setter
		this.name = name;
	}
	
	get name(){
    //this.name è°ƒç”¨ getter()(å¦‚æœæœ‰çš„è¯)
		return this._name;
	}
	set name(value){
		if(value.length<4){
			alert("Name is too short.");
			return;
		}
		this._name = value;
	}
}

let user = new User("John");
alert(user.name);
user = new User("");//Name is too short.
```

ä»æŠ€æœ¯æ¥è®²ï¼Œè¿™æ ·çš„ç±»å£°æ˜å¯ä»¥é€šè¿‡**åœ¨User.prototypeä¸­åˆ›å»ºgetterså’Œsetters**æ¥å®ç°ã€‚<!--ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ-->

### è®¡ç®—å±æ€§åç§° [â€¦]

```js
class User{
	['say'+'Hi'](){
		alert("Hello");
	}
}
new User().sayHi();
```

### Class å­—æ®µ ï¼ˆæ—§æµè§ˆå™¨éœ€polyfillğŸ˜²)

> **æ—§çš„æµè§ˆå™¨éœ€è¦polyfill**
>
> â€‹	ç±»å­—æ®µï¼ˆfieldï¼‰æ˜¯æœ€è¿‘æ‰æ·»åŠ åˆ°è¯­è¨€ä¸­çš„ã€‚

**ä¹‹å‰æˆ‘ä»¬çš„ç±»ä»…å…·æœ‰æ–¹æ³•ã€‚**

> åŒ…æ‹¬æ„é€ å‡½æ•°çš„constructor()æ–¹æ³• å’Œ å®šä¹‰åœ¨ç±»ä¸­ï¼Œå­˜å‚¨äºæ„é€ å‡½æ•°åï¼ˆç±»åï¼‰.prototypeä¸­æ–¹æ³•ã€‚

â€œç±»å­—æ®µâ€æ˜¯ä¸€ç§å…è®¸æ·»åŠ ä»»ä½•å±æ€§çš„è¯­æ³•ã€‚

```js
class User {
	name = "John";
	
	sayHi(){
		alert(`Hello,${this.name}!`);
	}
}

new User().sayHi(); //Hello,John!
```

ç±»å­—æ®µä¼šåœ¨**æ¯ä¸ªç‹¬ç«‹å¯¹è±¡**ä¸­è¢«è®¾å¥½ï¼Œ**è€Œä¸æ˜¯è®¾åœ¨User.prototype**ã€‚

> å¤§æ¦‚ç›¸å½“äº æ„é€ å‡½æ•° Function User(){ this.name = â€œJohnâ€; }

```js
class User {
  name = "John";
}

let user = new User();
alert(user.name); // John
alert(User.prototype.name); // undefined
```

å¯ä»¥åœ¨å¤åˆ¶æ—¶ä½¿ç”¨æ›´å¤æ‚ä¸­çš„è¡¨è¾¾å¼å’Œå‡½æ•°è°ƒç”¨ï¼š

```js
class User{
	name = prompt("Name,please?","John");
}

let user = new User();
alert(user.name);//John
```

### ä½¿ç”¨ç±»å­—æ®µåˆ¶ä½œç»‘å®šæ–¹æ³•

JavaScriptä¸­çš„å‡½æ•°å…·æœ‰åŠ¨æ€çš„thisï¼Œå®ƒå–å†³äºè°ƒç”¨ä¸Šä¸‹æ–‡ã€‚

å› æ­¤ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡æ–¹æ³•è¢«ä¼ é€’åˆ°æŸå¤„ï¼Œæˆ–è€…åœ¨å¦ä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­è¢«è°ƒç”¨ï¼Œthiså°†ä¸å†æ˜¯å¯¹å…¶å¯¹è±¡çš„å¼•ç”¨ã€‚

ä¾‹å¦‚ï¼Œæ­¤ä»£ç å°†æ˜¾ç¤º `undefined`ï¼š

```javascript
class Button {
  constructor(value) {
    this.value = value;
  }

  click() {
    alert(this.value);
  }
}

let button = new Button("hello");

setTimeout(button.click, 1000); // undefined
```

è¿™ä¸ªé—®é¢˜è¢«ç§°ä¸ºâ€œä¸¢å¤± `this`â€ã€‚

æˆ‘ä»¬åœ¨å‡½æ•°ç»‘å®šä¸€ç« ä¸­è®²è¿‡ï¼Œæœ‰ä¸¤ç§å¯ä»¥ä¿®å¤å®ƒçš„æ–¹å¼ï¼š

1. ä¼ é€’ä¸€ä¸ªåŒ…è£…å‡½æ•°ï¼Œä¾‹å¦‚ setTimeout(()=>button.click(),1000)
2. å°†æ–¹æ³•ç»‘å®šåˆ°å¯¹è±¡ï¼Œä¾‹å¦‚åœ¨constructorä¸­ this.click = this.**click**.**bind**(this);ã€‚

ç±»å­—æ®µæä¾›äº†å¦ä¸€ç§è¯­æ³•ï¼š

```js
class Button{
	constructor(value){
		this.value = value;
	}
	click = () => {
		alert(this.value);
	}
}

let button = new Button("Hello");
setTimeout(button.click, 1000);
```

ç±»å­—æ®µ==**click = () => {â€¦}**==æ˜¯åŸºäºæ¯ä¸€ä¸ª**å¯¹è±¡**è¢«åˆ›å»ºçš„ï¼Œåœ¨è¿™é‡Œå¯¹äºæ¯ä¸€ä¸ªButtonå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„æ–¹æ³•ï¼Œåœ¨å†…éƒ¨éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘æ­¤å¯¹è±¡çš„thisã€‚æˆ‘ä»¬å¯ä»¥æŠŠbutton.clickä¼ é€’åˆ°ä»»ä½•åœ°æ–¹ï¼Œè€Œä¸”thisçš„å€¼æ€»æ˜¯æ­£ç¡®çš„ã€‚

> ç†è§£å°±æ˜¯ï¼Œæ¯”å¦‚javaä¸­ç±»æ–¹æ³•å¯¹äºæ¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶æ–¹æ³•è°ƒç”¨å…¥å£æ˜¯ç›¸åŒçš„ï¼Œéœ€è¦ä¼ é€’thisç¡®å®šæ˜¯å“ªä¸€ä¸ªå¯¹è±¡åœ¨è°ƒç”¨
>
> è€Œç±»å­—æ®µclick =     () =>{â€¦}ï¼Œç›¸å½“äºåœ¨æ¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹åº”åœ°åˆ›å»ºäº†ä¸€ä¸ªå±æ€§ï¼Œä¸”è¯¥å±æ€§çš„å€¼ä¸ºä¸€ä¸ªæ–¹æ³•
>
> ä¼¼ä¹åœ¨è¿™äº›æ–¹æ³•å†…éƒ¨éƒ½æœ‰ä¸€ä¸ªæ­£ç¡®çš„this

åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œå®ƒå¯¹äºè¿›è¡Œäº‹ä»¶ç›‘å¬å°¤ä¸ºæœ‰ç”¨ã€‚



æŠ€æœ¯ä¸Šæ¥è¯´ï¼ŒMyClassæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå³æˆ‘ä»¬æä¾›ä½œä¸ºconstructorçš„å‡½æ•°ï¼Œè€Œmethods,getterså’Œsetterséƒ½è¢«å†™å…¥äº†MyClass.prototypeã€‚

## ç±»ç»§æ‰¿

ç±»ç»§æ‰¿æ˜¯ä¸€ä¸ªç±»æ‰©å±•å¦ä¸€ä¸ªç±»çš„ä¸€ç§æ–¹å¼ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç°æœ‰åŠŸèƒ½ä¹‹ä¸Šåˆ›å»ºæ–°åŠŸèƒ½ã€‚

### â€extendsâ€œå…³é”®å­—

å­ç±»å¯ä»¥è®¿é—®è‡ªå·±çš„**æ–¹æ³•**ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸€ç±»çš„å¯¹è±¡è®¿é—®ç»§æ‰¿ç±»çš„**æ–¹æ³•**ã€‚

åœ¨å†…éƒ¨ï¼Œå…³é”®å­—extendsä½¿ç”¨äº†å¾ˆå¥½çš„æ—§çš„åŸå‹æœºåˆ¶è¿›è¡Œå·¥ä½œã€‚

å®ƒå°†**å­ç±».prototype.(ç”¨äºå­˜å‚¨ç±»çš„æ–¹æ³•)[[Prototype]]**è®¾ç½®ä¸º**çˆ¶ç±».prototype**ï¼ˆçˆ¶ç±»çš„æ–¹æ³•ï¼‰ã€‚

æ‰€ä»¥ï¼Œå¦‚æœåœ¨å­ç±».prototypeä¸­æ‰¾ä¸åˆ°ä¸€ä¸ªæ–¹æ³•ï¼ŒJavaScriptå°±ä¼šä»çˆ¶ç±».prototypeä¸­è·å–è¯¥æ–¹æ³•ã€‚

![image-20211204002951919](C:\Users\Zirina\AppData\Roaming\Typora\typora-user-images\image-20211204002951919.png)

ä¾‹å¦‚ï¼Œè¦æŸ¥æ‰¾rabbit.runæ–¹æ³•ï¼Œå¼•æ“æ£€æŸ¥é¡ºåºå¦‚ä¸‹ï¼š

1. æŸ¥æ‰¾å¯¹è±¡rabbit
2. æŸ¥æ‰¾ä»–çš„åŸå‹ï¼Œå³Rabbit.prototype
3. æŸ¥æ‰¾Rabbit.prototypeçš„åŸå‹ï¼Œå³Animal.prototype

JavaScriptå†…å»ºå¯¹è±¡ä¹ŸåŒæ ·ä½¿ç”¨**åŸå‹ç»§æ‰¿**ã€‚

ä¾‹å¦‚ï¼Œ**Date.prototype.[[Prototype]]** æ˜¯ **Object.prototype**ã€‚

å› æ­¤æ—¥æœŸå¯ä»¥è®¿é—®é€šç”¨å¯¹è±¡çš„æ–¹æ³•ã€‚

#### åœ¨extendsåå…è®¸ä»»æ„è¡¨è¾¾å¼

ç±»è¯­æ³•ä¸ä»…å…è®¸æŒ‡å®šä¸€ä¸ªç±»ï¼Œåœ¨extendsåå¯ä»¥æŒ‡å®šä»»æ„è¡¨è¾¾å¼ã€‚

ä¾‹å¦‚ï¼Œä¸€ä¸ªç”Ÿæˆçˆ¶ç±»çš„å‡½æ•°è°ƒç”¨ï¼š

```js
function f(phrase){
	return class{
		sayHi(){	alert(phrase); }
	};
}

class User extends f("Hello"){}
new User().sayHi();//Hello
```

æˆ‘ä»¬å¯ä»¥æ ¹æ®è®¸å¤šæ¡ä»¶ä½¿ç”¨å‡½æ•°ç”Ÿæˆç±»ã€‚



### é‡å†™æ–¹æ³•

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æœªåœ¨å­ç±»ä¸­æŒ‡å®šçš„æ–¹æ³•å‡ä»çˆ¶ç±»ä¸­ç›´æ¥è·å–ã€‚

ä½†æ˜¯å¦‚æœåœ¨å­ç±»ä¸­æŒ‡å®šäº†åŒä¸€æ–¹æ³•åçš„æ–¹æ³•ï¼Œé‚£ä¹ˆå°†ä¼šä½¿ç”¨å®ƒã€‚

ä½†æ˜¯é€šå¸¸æ¥è¯´ï¼Œä¸å¸Œæœ›å®Œå…¨æ›¿æ¢çˆ¶ç±»çš„æ–¹æ³•ï¼Œè€Œæ˜¯å¸Œæœ›åœ¨çˆ¶ç±»æ–¹æ³•çš„åŸºç¡€ä¸Šè¿›è¡Œè°ƒæ•´æˆ–æ‰©å±•å…¶åŠŸèƒ½ã€‚

Classä¸ºæ­¤æä¾›äº†â€superâ€å…³é”®å­—ã€‚

- æ‰§è¡Œ super.method(â€¦)æ¥è°ƒç”¨ä¸€ä¸ªçˆ¶ç±»æ–¹æ³•ã€‚
- æ‰§è¡Œ super(â€¦) æ¥è°ƒç”¨ä¸€ä¸ªçˆ¶ç±»constructor(åªèƒ½åœ¨æˆ‘ä»¬çš„constructorä¸­)ã€‚

ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬çš„ rabbit åœ¨åœä¸‹æ¥çš„æ—¶å€™è‡ªåŠ¨ hideï¼š

```javascript
class Animal {

  constructor(name) {
    this.speed = 0;
    this.name = name;
  }

  run(speed) {
    this.speed = speed;
    alert(`${this.name} runs with speed ${this.speed}.`);
  }

  stop() {
    this.speed = 0;
    alert(`${this.name} stands still.`);
  }

}

class Rabbit extends Animal {
  hide() {
    alert(`${this.name} hides!`);
  }

  stop() {
    super.stop(); // è°ƒç”¨çˆ¶ç±»çš„ stop
    this.hide(); // ç„¶å hide
  }
}

let rabbit = new Rabbit("White Rabbit");

rabbit.run(5); // White Rabbit ä»¥é€Ÿåº¦ 5 å¥”è·‘
rabbit.stop(); // White Rabbit åœæ­¢äº†ã€‚White rabbit hide äº†ï¼
```

ç°åœ¨ï¼Œ`Rabbit` åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨çˆ¶ç±»çš„ `super.stop()` æ–¹æ³•ï¼Œæ‰€ä»¥ `Rabbit` ä¹Ÿå…·æœ‰äº† `stop` æ–¹æ³•ã€‚

//ä½†æ˜¯å¥½åƒåªèƒ½åœ¨è‡ªå·±çš„ä»£ç è¿‡ç¨‹ä¸­å®Œæ•´åœ°è°ƒç”¨çˆ¶ç±»æ–¹æ³•ã€‚

#### ç®­å¤´å‡½æ•°æ²¡æœ‰ super

å¦‚æœè¢«è®¿é—®ï¼Œä»–ä¼šä»å¤–éƒ¨å‡½æ•°è·å–ã€‚

```js
class Rabbit extends Animal {
	stop() {
		setTimeout(() => super.stop(),1000);
	}
}
```

å¦‚æœæŒ‡å®šä¸€ä¸ªæ™®é€šçš„å‡½æ•°ï¼Œé‚£å°†ä¼šæŠ›å‡ºé”™è¯¯ã€‚

### é‡å†™ constructor

ä¸Šè¿°ä»£ç ä¸­çš„Rabbitè¿˜æ²¡æœ‰è‡ªå·±çš„constructorã€‚

æ ¹æ®è§„èŒƒï¼Œå¦‚æœä¸€ä¸ªç±»æ‰©å±•äº†å¦ä¸€ä¸ªç±»å¹¶ä¸”æ²¡æœ‰constructorï¼Œé‚£ä¹ˆå°†ç”Ÿäº§ä¸‹é¢è¿™æ ·çš„ç©ºconstructor:

```js
class Rabbit extends Animal {
  //ä¸ºæ²¡æœ‰è‡ªå·±çš„construtorçš„æ‰©å±•ç±»ç”Ÿæˆçš„
	constructor(...args){
		super(...args);
	}
}
```

é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒè°ƒç”¨äº†çˆ¶ç±»çš„constructorï¼Œå¹¶ä¼ é€’äº†æ‰€æœ‰çš„å‚æ•°ã€‚

**==ç»§æ‰¿ç±»çš„constructorå¿…é¡»è°ƒç”¨super(â€¦)ï¼Œå¹¶ä¸”ä¸€å®šè¦åœ¨ä½¿ç”¨thisè¿™ä¹‹å‰è°ƒç”¨ã€‚==**

> javaçš„é»˜è®¤æ„é€ æ–¹æ³•æ˜¯ä¸€ä¸ªéšå¼è°ƒç”¨äº†æ— å‚æ„é€ å‡½æ•°super()ï¼Œæ²¡æœ‰å…¶ä»–è¯­å¥çš„æ–¹æ³•ã€‚
>
> è€ŒJavaScriptçš„é»˜è®¤æ„é€ æ–¹æ³•ä¼š**æ ¹æ®ä¼ å…¥çš„å‚æ•°**ï¼Œä½¿ç”¨å‚æ•°è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•

å¦‚æœç»§æ‰¿ç±»é‡å†™constructoræ²¡æœ‰æ˜¾å¼è°ƒç”¨superï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚

åœ¨JavaScriptä¸­ï¼Œç»§æ‰¿ç±»ï¼ˆæ‰€è°“çš„â€œæ´¾ç”Ÿæ„é€ ç±»â€ï¼‰çš„æ„é€ å‡½æ•°ä¸å…¶ä»–å‡½æ•°ä¹‹é—´æ˜¯æœ‰åŒºåˆ«çš„ã€‚

æ´¾ç”Ÿæ„é€ ç±»å…·æœ‰ç‰¹æ®Šçš„å†…éƒ¨å±æ€§**==[[ConstructorKind]]:â€derivedâ€==**ã€‚è¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å†…éƒ¨æ ‡ç­¾ã€‚

è¯¥æ ‡ç­¾ä¼šå½±å“å®ƒçš„newè¡Œä¸ºï¼š

- å½“**é€šè¿‡new**æ‰§è¡Œä¸€ä¸ªå¸¸è§„å‡½æ•°æ—¶ï¼Œå®ƒå°†**åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡**ï¼Œå¹¶å°†è¿™ä¸ª**ç©ºå¯¹è±¡èµ‹å€¼ç»™this**ã€‚

- ä½†æ˜¯å½“**ç»§æ‰¿çš„constructor**æ‰§è¡Œæ—¶ï¼Œä»–ä¸ä¼šæ‰§è¡Œæ­¤æ“ä½œã€‚å®ƒ**æœŸæœ›çˆ¶ç±»çš„constructoræ¥å®Œæˆè¿™é¡¹å·¥ä½œ**ã€‚

  > å’Œ Javaä¸€è‡´ã€‚
  >
  > java å¿…é¡»å…ˆè°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•° æ‰èƒ½è°ƒç”¨å­ç±»çš„ã€‚

å› æ­¤ï¼Œæ´¾ç”Ÿçš„constructorå¿…é¡»è°ƒç”¨superæ‰èƒ½æ‰§è¡Œå…¶çˆ¶ç±»ï¼ˆbaseï¼‰çš„constructorï¼Œå¦åˆ™thisæŒ‡å‘çš„å¯¹è±¡å°†ä¸ä¼šè¢«åˆ›å»ºã€‚

### é‡å†™ç±»å­—æ®µ

æˆ‘ä»¬å¯ä»¥é‡å†™ç±»å­—æ®µï¼Œä½†å½“æˆ‘ä»¬è®¿é—®åœ¨çˆ¶ç±»æ„é€ å™¨ä¸­çš„ä¸€ä¸ªè¢«é‡å†™çš„å­—æ®µæ—¶ï¼š

```js
class Animal {
	name = 'animal';
	
	constructor(){
		alert(this.name);
	}
}

class Rabbit extends Animal {
	name = 'rabbit';
}

new Animal();//animal
new Rabbit();//animal
```

å› ä¸ºRabbitæ²¡æœ‰è‡ªå·±çš„æ„é€ å™¨ï¼Œæ‰€ä»¥Animalçš„æ„é€ å™¨è¢«è°ƒç”¨äº†ã€‚

==**çˆ¶ç±»æ„é€ å™¨æ€»æ˜¯ä¼šä½¿ç”¨ä»–è‡ªå·±å­—æ®µçš„å€¼ï¼Œè€Œä¸æ˜¯è¢«é‡å†™çš„é‚£ä¸€ä¸ªã€‚**==

ä½†å½“æˆ‘ä»¬ä½¿ç”¨æ–¹æ³•è€Œä¸æ˜¯å­—æ®µï¼š

```js
class Animal{
	showName(){
		alert('animal');
	}
	
	constructor(){
		this.showName();
	}
}
class Rabbit extends Animal {
	showName(){
		alert('rabbit');
	}
}

new Animal();//animal
new Rabbit();//rabbit
```

> new Animal() ->è°ƒç”¨Function Animal(){}å³constructor(){â€¦}
>
> å› ä¸ºAnimalæ²¡æœ‰[[ConstructorKind]]å­—æ®µï¼ˆï¼Ÿå¾…æŸ¥è¯ï¼‰ å› æ­¤ä¼šåˆ›å»ºthis = {}
>
> ä¸”this.[[Prototype]] = Animal.prototype;
>
> ç„¶åè°ƒç”¨ this.showName()ï¼› åœ¨this.[[Prototype]]ä¸­æ‰¾åˆ°ï¼Œå¹¶è°ƒç”¨ã€‚
>
> 
>
> new Rabbit() ->super();  = Function Animal(){} 
>
> åœ¨constructorä¸­æ„é€ äº†thisï¼Œè°ƒç”¨this.showName();
>
> ä¸” this.[[Prototype]] = ???
>
> å› æ­¤this.showName

å½“çˆ¶ç±»æ„é€ å™¨åœ¨æ´¾ç”Ÿçš„ç±»ä¸­è¢«è°ƒç”¨æ—¶ï¼Œå®ƒä¼šä½¿ç”¨è¢«é‡å†™çš„æ–¹æ³•ã€‚//ä½†æ˜¯ä¸ºå•¥å‘¢ï¼ŸğŸ˜µ

<!--æ˜¯å› ä¸ºconstructorä¸­çš„thisæŒ‡å‘çš„åŸå› å—ï¼Ÿ-->

ä½†å¯¹äºç±»å­—æ®µå¹¶éå¦‚æ­¤ã€‚

å®é™…ä¸Šï¼ŒåŸå› åœ¨äºå­—æ®µåˆå§‹åŒ–çš„é¡ºåºã€‚ç±»å­—æ®µæ˜¯è¿™æ ·åˆå§‹åŒ–çš„ï¼š

- å¯¹äºåŸºç±»ï¼ˆè¿˜æœªç»§æ‰¿ä»»ä½•ä¸œè¥¿ï¼‰ï¼Œåœ¨**æ„é€ å‡½æ•°è°ƒç”¨å‰**åˆå§‹åŒ–ã€‚
- å¯¹äºæ´¾ç”Ÿç±»ï¼Œåœ¨super()åç«‹åˆ»åˆå§‹åŒ–ã€‚

å› æ­¤ï¼Œåœ¨çˆ¶ç±»æ„é€ å™¨è¢«æ‰§è¡Œçš„æ—¶å€™ï¼ŒRabbitè¿˜æ²¡æœ‰è‡ªå·±çš„ç±»å­—æ®µï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆçˆ¶ç±»çš„ç±»å­—æ®µè¢«ä½¿ç”¨äº†ã€‚

å¦‚æœå‡ºé—®é¢˜äº†ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨**æ–¹æ³•**æˆ–è€…**getter/setter**æ›¿ä»£ç±»å­—æ®µä¿®å¤é—®é¢˜ã€‚

è¿™ç§å­—æ®µå’Œæ–¹æ³•ä¹‹é—´å¾®å¦™çš„åŒºåˆ«åªç‰¹å®šäºJavaScriptã€‚

**æ­¤Bugåªåœ¨ä¸€ä¸ªè¢«é‡å†™çš„å­—æ®µè¢«çˆ¶ç±»æ„é€ å™¨ä½¿ç”¨æ—¶æ‰ä¼šæ˜¾ç°å‡ºæ¥ã€‚**

### æ·±å…¥ï¼šå†…éƒ¨æ¢ç©¶å’Œ[[HomeObject]]

#### superæ˜¯ä¸å¯èƒ½è¿è¡Œçš„

==å½“ä¸€ä¸ª**å¯¹è±¡æ–¹æ³•**æ‰§è¡Œæ—¶ï¼Œå®ƒä¼šå°†**å½“å‰å¯¹è±¡**ä½œä¸ºthisã€‚==

éšåå¦‚æœæˆ‘ä»¬è°ƒç”¨super.method()ï¼Œéœ€è¦ä»å½“å‰å¯¹è±¡çš„åŸå‹ä¸­è·å–methodã€‚

this.\__proto__.method ? è¿™æ˜¯è¡Œä¸é€šçš„ã€‚

```js
let animal = {
	name:"Animal",
	eat(){
		alert(`${this.name} eats.`);
	}
};

let rabbit = {
	__proto__:animal,
	name:"Rabbit",
	eat(){
		this.__proto__.eat.call(this);//(*)
	}
};
rabbit.eat();//Rabbit eats.
```

æˆ‘ä»¬ä»åŸå‹ä¸­è·å–eatï¼Œå¹¶**åœ¨å½“å‰å¯¹è±¡çš„ä¸Šä¸‹æ–‡ä¸­**è°ƒç”¨å®ƒã€‚

**.call(this)**åœ¨è¿™é‡Œéå¸¸é‡è¦ï¼Œå› ä¸ºç®€å•çš„è°ƒç”¨å°†åœ¨**åŸå‹çš„ä¸Šä¸‹æ–‡**ä¸­æ‰§è¡Œeatï¼Œè€Œéå½“å‰å¯¹è±¡ã€‚

> å°±æ˜¯è¯´ this.\_\_proto\_\_.eat(); ä¼šå°†this.\__proto__ä½œä¸ºæ–°çš„thisï¼Œæ¥è°ƒç”¨this.\_\_proto\_\_ä¸­çš„eatæ–¹æ³• ?
>
> æ€ªä¸å¾—éœ€è¦superâ€¦
>
> å¥½ä½ å¦ˆæ€ªï¼ï¼

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸€åˆ‡æ­£å¸¸ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬åœ¨åŸå‹é“¾ä¸Šå†æ·»åŠ ä¸€ä¸ªå¯¹è±¡ï¼š

```js
let animal = {
  name: "Animal",
  eat() {
    alert(`${this.name} eats.`);
  }
};

let rabbit = {
  __proto__: animal,
  eat() {
    // ...bounce around rabbit-style and call parent (animal) method
    this.__proto__.eat.call(this); // (*)
  }
};

let longEar = {
  __proto__: rabbit,
  eat() {
    // ...do something with long ears and call parent (rabbit) method
    this.__proto__.eat.call(this); // (**)
  }
};

longEar.eat(); // Error: Maximum call stack size exceeded
```

åœ¨ï¼ˆ*ï¼‰å’Œï¼ˆ**ï¼‰ä¸­ï¼Œthisçš„å€¼éƒ½æ˜¯å½“å‰å¯¹è±¡ï¼ˆlongEar)ã€‚

**æ‰€æœ‰çš„å¯¹è±¡æ–¹æ³•éƒ½å°†å½“å‰å¯¹è±¡ä½œä¸ºthis**ï¼Œè€ŒéåŸå‹ã€‚

å› æ­¤ï¼Œä¸Šè¿°ä¸¤è¡Œä¸­this.\__proto__çš„å€¼æ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œéƒ½æ˜¯rabbitã€‚å®ƒä»¬ä¸¤éƒ½è°ƒç”¨çš„æ˜¯rabbit.eatï¼Œå®ƒä»¬ä¸åœåœ°å¾ªç¯è°ƒç”¨è‡ªå·±ï¼Œè€Œä¸æ˜¯åœ¨åŸå‹é“¾ä¸Šå‘ä¸Šå¯»æ‰¾æ–¹æ³•ã€‚

<img src="C:\Users\Zirina\AppData\Roaming\Typora\typora-user-images\image-20211204012430827.png" alt="image-20211204012430827" style="zoom:80%;" />

#### [[HomeObject]]

ä¸ºäº†æä¾›è§£å†³æ–¹æ³•ï¼ŒJavaScriptä¸ºå‡½æ•°æ·»åŠ äº†ä¸€ä¸ªç‰¹æ®Šçš„å†…éƒ¨å±æ€§ï¼š[[HomeObject]]ã€‚

å½“ä¸€ä¸ªå‡½æ•°è¢«å®šä¹‰ä¸º**ç±»**æˆ–è€…**å¯¹è±¡æ–¹æ³•**ï¼Œå®ƒçš„[[HomeObject]]å±æ€§å°±æˆä¸ºäº†è¯¥å¯¹è±¡ã€‚

ç„¶å**super**ä½¿ç”¨å®ƒæ¥è§£æï¼ˆresolveï¼‰çˆ¶åŸå‹åŠå…¶æ–¹æ³•ã€‚

å¯¹äºæ™®é€šå¯¹è±¡ï¼š

```js
let animal = {
	name:"Animal",
	eat(){
		alert(`${this.name} eats.`);
	}
};

let rabbit = {
	__proto__:animal,
	name:"Rabbit",
	eat(){				//rabbit.eat.[[HomeObject]] == rabbit
		super.eat();
	}
};

let longEar = {
  __proto__:rabbit,
  name:"Long Ear",
  eat(){
    	super.eat();
  }
};

longEar.eat();//Long Ear eats.
```

#### æ–¹æ³•å¹¶ä¸æ˜¯è‡ªç”±çš„

ä¹‹å‰æ‰€å­¦çŸ¥é“ï¼Œå‡½æ•°é€šå¸¸éƒ½æ˜¯â€œè‡ªç”±â€çš„ï¼Œå¹¶æ²¡æœ‰ç»‘å®šåˆ°JavaScriptä¸­çš„å¯¹è±¡ã€‚å› æ­¤ï¼Œå®ƒä»¬å¯ä»¥åœ¨å¯¹è±¡é—´å¤åˆ¶ï¼Œå¹¶ç”¨å¦å¤–ä¸€ä¸ªthisè°ƒç”¨å®ƒã€‚

[[HomeObject]]çš„å­˜åœ¨è¿åäº†è¿™ä¸ªåŸåˆ™ï¼Œå› ä¸ºæ–¹æ³•è®°ä½äº†å®ƒä»¬çš„å¯¹è±¡ã€‚[[HomeObject]]ä¸èƒ½è¢«æ›´æ”¹ï¼Œå› æ­¤è¯¥ç»‘å®šæ˜¯æ°¸ä¹…çš„ã€‚

> å¥½åƒç±»å­—æ®µ ç»‘å®šæ–¹æ³•

åœ¨JavaScriptä¸­[[HomeObject]]**ä»…è¢«ç”¨äºsuper**ã€‚æ‰€ä»¥ï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•ä¸ä½¿ç”¨superï¼Œé‚£ä¹ˆå®ƒä»å¯ä»¥è§†ä¸ºæ˜¯è‡ªç”±çš„ï¼Œå¹¶ä¸”å¯åœ¨**å¯¹è±¡ä¹‹é—´å¤åˆ¶**ã€‚

```js
let animal = {
	sayHi(){
		alert(`I'm an animal`);
	}
};

//rabbitç»§æ‰¿è‡ªanimal
let rabbit = {
	__proto__:animal,
	sayHi(){
		super.sayHi();
	}
};

let plant = {
	sayHi(){
		alert("I'm a plant.");
	}
};

let tree = {
	__proto__:plant,
	sayHi:rabbit.sayHi
};

tree.sayHi(); //I'm an animal.
```

tree.sayHiæ–¹æ³•æ˜¯ä»rabbitå¤åˆ¶è€Œæ¥ã€‚

å®ƒçš„[[HomeObject]]æ˜¯rabbitï¼Œå› ä¸ºå®ƒæ˜¯åœ¨rabbitä¸­åˆ›å»ºçš„ã€‚

==**æ²¡æœ‰åŠæ³•ä¿®æ”¹[[HomeObject]]**==ã€‚

tree.sayHi()å†…å…·æœ‰super.sayHi()ï¼Œå®ƒä»rabbitä¸­ä¸Šæº¯ï¼Œç„¶åä»animalä¸­è·å–æ–¹æ³•ã€‚

<img src="C:\Users\Zirina\AppData\Roaming\Typora\typora-user-images\image-20211208010103263.png" alt="image-20211208010103263" style="zoom:67%;" />

#### æ–¹æ³•ï¼Œä¸æ˜¯å‡½æ•°å±æ€§

[[HomeObject]]æ˜¯ä¸º**ç±»**å’Œ**æ™®é€šå¯¹è±¡ä¸­çš„æ–¹æ³•**å®šä¹‰çš„ã€‚

ä½†æ˜¯å¯¹äº**å¯¹è±¡**è€Œè¨€ï¼Œæ–¹æ³•å¿…é¡»ç¡®åˆ‡æŒ‡å®šä¸º**method()**ï¼Œè€Œä¸æ˜¯**method:function()**ã€‚

```js
let animal = {
  eat: function() { // è¿™é‡Œæ˜¯æ•…æ„è¿™æ ·å†™çš„ï¼Œè€Œä¸æ˜¯ eat() {...
    // ...
  }
};

let rabbit = {
  __proto__: animal,
  eat: function() {
    super.eat();
  }
};

rabbit.eat();  // é”™è¯¯è°ƒç”¨ superï¼ˆå› ä¸ºè¿™é‡Œæ²¡æœ‰ [[HomeObject]]ï¼‰
```

### æ‰©å±• clock

æˆ‘ä»¬è·å¾—äº†ä¸€ä¸ª `Clock` ç±»ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå®ƒæ¯ç§’éƒ½ä¼šæ‰“å°ä¸€æ¬¡æ—¶é—´ã€‚

```javascript
class Clock {
  constructor({ template }) {
    this.template = template;
  }

  render() {
    let date = new Date();

    let hours = date.getHours();
    if (hours < 10) hours = '0' + hours;

    let mins = date.getMinutes();
    if (mins < 10) mins = '0' + mins;

    let secs = date.getSeconds();
    if (secs < 10) secs = '0' + secs;

    let output = this.template
      .replace('h', hours)
      .replace('m', mins)
      .replace('s', secs);

    console.log(output);
  }

  stop() {
    clearInterval(this.timer);
  }

  start() {
    this.render();
    this.timer = setInterval(() => this.render(), 1000);
  }
}
```

<!--æ­¤å¤„çš„start()ä¸­éœ€è¦å…ˆè¿è¡Œä¸€æ¬¡render()å¯èƒ½æ˜¯å› ä¸ºsetIntervalçš„ç¬¬ä¸€æ¬¡è°ƒç”¨æ˜¯åœ¨è§„å®šçš„æ—¶é—´é—´éš”ä¹‹å-->

åˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ª `Clock` çš„æ–°çš„ç±» `ExtendedClock`ï¼Œå¹¶æ·»åŠ å‚æ•° `precision` â€” æ¯æ¬¡ â€œticksâ€ ä¹‹é—´é—´éš”çš„æ¯«ç§’æ•°ï¼Œé»˜è®¤æ˜¯ `1000`ï¼ˆ1 ç§’ï¼‰ã€‚

- ä½ çš„ä»£ç åº”è¯¥åœ¨ `extended-clock.js` æ–‡ä»¶é‡Œã€‚
- ä¸è¦ä¿®æ”¹åŸæœ‰çš„ `clock.js`ã€‚è¯·æ‰©å±•å®ƒã€‚

**è§£å†³æ–¹æ¡ˆ**

```javascript
class ExtendedClock extends Clock {
  constructor(options) {
    super(options); // amazing æ˜¯é»˜è®¤æ„é€ æ–¹æ³•çš„å®ç°æ€è·¯
    let { precision = 1000 } = options;  //amazing
    this.precision = precision;
  }
  //or è§£æ„èµ‹å€¼
  constructor({template,precision = 1000}){
		super({template});
    this.precision = precision;
  }

  start() {
    super.render(); // this or super?
    //super æ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºæ–¹æ³•æ€»æ˜¯ä¼šåœ¨prototypeé‡Œé¢å»æ‰¾ï¼Œç„¶ååœ¨å®ƒçš„åŸå‹é“¾ä¸­æ‰¾
    this.timer = setInterval(() => super.render(), this.precision);
  }
};
```

## é™æ€å±æ€§å’Œé™æ€æ–¹æ³•

æˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ªæ–¹æ³•èµ‹å€¼ç»™**ç±»çš„å‡½æ•°**æœ¬èº«ï¼Œè€Œä¸æ˜¯èµ‹ç»™å®ƒçš„**â€œprototypeâ€**ã€‚

è¢«ç”¨äºå½“æˆ‘ä»¬æƒ³è¦å­˜å‚¨ç±»çº§åˆ«çš„æ•°æ®æ—¶ï¼Œè€Œä¸æ˜¯ç»‘å®šåˆ°å®ä¾‹ã€‚

è¿™æ ·çš„æ–¹æ³•è¢«ç§°ä¸ºé™æ€çš„ï¼ˆstaticï¼‰ã€‚

åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œå®ƒä»¬ä»¥staticå…³é”®å­—å¼€å¤´ã€‚

```js
class User{
	static staticMethod(){
		alert(this === User);
	}
}
User.staticMethod();//true
```

å®é™…ä¸Šè·Ÿç›´æ¥==**å°†å…¶ä½œä¸ºå±æ€§èµ‹å€¼**==çš„ä½œç”¨ç›¸åŒã€‚

```js
class User{}

User.staticMethod = function(){
	alert(this === User);
};
User.staticMethod(); // true
```

é€šå¸¸ï¼Œé™æ€æ–¹æ³•ç”¨äºå®ç°å±äºè¯¥ç±»ä½†ä¸å±äºè¯¥ç±»ä»»ä½•ç‰¹å®šå¯¹è±¡çš„å‡½æ•°ã€‚

ä¾‹å¦‚ï¼Œ**åŒä¸€ä¸ªç±»çš„å¯¹è±¡ä¹‹é—´çš„æ¯”è¾ƒå™¨**ï¼š

```js
class Article {
	constructor(title, date){
		this.title = title;
		this.date = date;
	}
	
	static compare(articleA, articleB){
		return articleA.date - articleB.date;
	}
}

let articles = [
	new Article("HTML",new Date(2021,11,9)),
	new Article("CSS", new Date(2019, 0, 1)),//0ä»£è¡¨ä¸€æœˆã€‚
  new Article("JavaScript", new Date(2019, 11, 1))
];

articles.sort(Article.compare);
alert(articles[0].title);//CSS
```

> wocï¼Œå¥½åƒjava
>
> javaä¸­æ˜¯ Arrays.sort(articles); Articleè¦å®ç°comparableæ¥å£

è¿™é‡Œ Article.compare ä¸æ˜¯å•ç‹¬çš„Articleå¯¹è±¡çš„æ–¹æ³•ï¼Œè€Œæ˜¯æ•´ä¸ªclassç±»çš„æ–¹æ³•ã€‚

**é€šè¿‡é™æ€æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼ˆå·¥å‚æ–¹æ³•ï¼‰**

**==return new this(â€¦args)ï¼›==**

> java çš„é™æ€æ–¹æ³•ä¸èƒ½ä½¿ç”¨this
>
> JavaScriptæ˜¯.å‰çš„å¯¹è±¡ã€‚

```js
class Article {
  constructor(title, date) {
    this.title = title;
    this.date = date;
  }
  
  static createTodays(){
  	return new this("Today's digest",new Date());
  }
}

let article = Article.createTodays();

```

**é™æ€æ–¹æ³•ä¹Ÿè¢«ç”¨äºä¸æ•°æ®åº“ç›¸å…³çš„å…¬å…±ç±»**

```js
Article.remove({id: 12345});
```

### é™æ€å±æ€§

==ä¸ç±»å­—æ®µä¸åŒï¼Œç±»å­—æ®µä¼šè¢«è®¾ç½®åœ¨æ¯ä¸€ä¸ªå¯¹è±¡ä¸­ã€‚==

```js
class Article{
	static publisher = "Levi Ackerman";
}
alert(Article.publisher);//Levi Ackerman
```

ç­‰åŒäº**ç›´æ¥ç»™Articleèµ‹å€¼**ï¼š

```js
Article.publisher = "Levi Ackerman";
```

### ç»§æ‰¿é™æ€å±æ€§å’Œæ–¹æ³•

==**é™æ€å±æ€§å’Œæ–¹æ³•æ˜¯å¯è¢«ç»§æ‰¿çš„**==ã€‚

```js
class Animal {
  static planet = "Earth";

  constructor(name, speed) {
    this.speed = speed;
    this.name = name;
  }

  run(speed = 0) {
    this.speed += speed;
    alert(`${this.name} runs with speed ${this.speed}.`);
  }

  static compare(animalA, animalB) {
    return animalA.speed - animalB.speed;
  }

}

// ç»§æ‰¿äº Animal
class Rabbit extends Animal {
  hide() {
    alert(`${this.name} hides!`);
  }
}

let rabbits = [
  new Rabbit("White Rabbit", 10),
  new Rabbit("Black Rabbit", 5)
];

rabbits.sort(Rabbit.compare);

rabbits[0].run(); // Black Rabbit runs with speed 5.

alert(Rabbit.planet); // Earth
```

å½“è°ƒç”¨Rabbit.compareæ—¶ï¼Œç»§æ‰¿çš„Animal.compareå°†ä¼šè¢«è°ƒç”¨ã€‚

extendsè®©**Rabbit çš„ [[Prototype]]** æŒ‡å‘äº† **Animal**ã€‚

<img src="C:\Users\Zirina\AppData\Roaming\Typora\typora-user-images\image-20211209005417468.png" alt="image-20211209005417468" style="zoom:67%;" />

å› æ­¤ï¼ŒRabbit extends Animal **åˆ›å»ºäº†ä¸¤ä¸ª[[Prototype]]å¼•ç”¨**ï¼š

- Rabbit å‡½æ•°åŸå‹ç»§æ‰¿è‡ª Animal å‡½æ•°ã€‚

  > ç”¨äºé™æ€æ–¹æ³•å’Œé™æ€å±æ€§çš„ç»§æ‰¿ã€‚

- Rabbit.prototype åŸå‹ç»§æ‰¿è‡ª Animal.prototypeã€‚

  > ç”¨äºå¯¹è±¡å®ä¾‹æ–¹æ³•çš„ç»§æ‰¿ã€‚

### ç±»æ‰©å±•è‡ªå¯¹è±¡

æ‰€æœ‰çš„å¯¹è±¡é€šå¸¸éƒ½ç»§æ‰¿è‡ª Object.prototype ï¼Œå¹¶å¯ä»¥è®¿é—®é€šç”¨å¯¹è±¡æ–¹æ³•ï¼Œå¦‚hasOwnProperty ç­‰ã€‚

```js
class Rabbit extends Object {
	constructor{
		super();//ç»§æ‰¿ç±»ä¸€å®šè¦è°ƒç”¨super()
		this.name = name;
	}
}

let rabbit = new Rabbit("Rab");
alert(rabbit.hasOwnProperty('name'));//Error

```

**class Rabbit extends Object** ä¸ **class Rabbit** å­˜åœ¨ç€é‡è¦å·®å¼‚ã€‚

#### 1.constructorä¸­ extends Object éœ€è¦è°ƒç”¨super()

#### 2.Rabbit.\__proto__åŸå‹ä¸åŒ

å› ä¸º **extendsè¯­æ³•** ä¼šè®¾ç½®ä¸¤ä¸ªåŸå‹ï¼š

- åœ¨æ„é€ å‡½æ•°çš„â€œpropertyâ€ä¹‹é—´è®¾ç½®åŸå‹	--è·å–å®ä¾‹æ–¹æ³•
- åœ¨æ„é€ å‡½æ•°ä¹‹é—´è®¾ç½®åŸå‹      â€“è·å–é™æ€æ–¹æ³•å’Œé™æ€å±æ€§

**1.å¦‚æœextends Objectï¼š** 

- Rabbit.\_\_proto\_\_ ==\= Object  
  - **Object.\__proto__ === Function.prototype**
- Rabbit.prototype.\__proto__  \=\=\= Object.prototype

**2.å¦‚æœæ²¡æœ‰ï¼š** 

- Rabbit.\__proto__ \==\= ==**Function.prototype**== 

- Rabbit.prototype.\__proto__ \==\= Object.prototype 

  > å¯¹è±¡çš„é¡¶éƒ¨åŸå‹éƒ½æ˜¯Object.prototype
  >
  > æ–¹æ³•çš„åŸå‹æ˜¯ Function.prototype

å› æ­¤ï¼ŒRabbitç°åœ¨å¯ä»¥é€šè¿‡Rabbitè®¿é—®Objectçš„**é™æ€æ–¹æ³•**ï¼š

```js
alert(	Rabbit.getOwnPropertyNames({a:1,b:2}));//a,b
```

ä½†æ˜¯å¦‚æœæ²¡æœ‰extends Objectï¼Œé‚£ä¹ˆRabbit.\__proto__ä¸ä¼šè¢«è®¾ç½®ä¸ºObjectã€‚å› æ­¤æ— æ³•è®¿é—®Objectçš„é™æ€æ–¹æ³•ã€‚

**Function.prototype** æœ‰ä¸€äº›ï¼ˆå®ä¾‹ï¼‰å‡½æ•°æ–¹æ³•ï¼Œä¾‹å¦‚ **call** å’Œ **bind** ã€‚

åœ¨ä¸Šè¿°ä¸¤ç§æƒ…å†µä¸‹ä»–ä»¬éƒ½æ˜¯å¯ç”¨çš„ã€‚

> éš¾ä»¥ç†è§£ã€‚
>
> æˆ‘è§‰å¾—æ˜¯ç”¨æ–¹æ³•å»è°ƒç”¨call / bind
>
> è€Œæ–¹æ³•åº”è¯¥æ˜¯åœ¨è‡ªå·±çš„åŸå‹é“¾ä¸­
>
> function.prototype = Function.prototype

==**å› ä¸ºå¯¹äºå†…å»ºçš„Objectæ„é€ å‡½æ•°è€Œè¨€ï¼ŒObject.\__proto__ \=\== Function.prototypeã€‚**==

Rabbit å±äºæ–¹æ³•çš„å®ä¾‹ï¼Œæ˜¯å†…å»ºæ„é€ å™¨Functionçš„å¯¹è±¡ï¼Œå› è€ŒåŸå‹ä¸ºFunction.prototypeã€‚

<!--æˆ‘ä¸æ˜ç™½ï¼Œå¯¹è±¡è°ƒç”¨å®ä¾‹æ–¹æ³•ä¼šä»è¿™é‡Œæ‰¾å—-->

<img src="C:\Users\Zirina\AppData\Roaming\Typora\typora-user-images\image-20211210195330705.png" alt="image-20211210195330705" style="zoom:67%;" />

## ç§æœ‰çš„å’Œå—ä¿æŠ¤çš„å±æ€§å’Œæ–¹æ³•

### å†…éƒ¨æ¥å£å’Œå¤–éƒ¨æ¥å£

- å†…éƒ¨æ¥å£â€”â€”å¯ä»¥é€šè¿‡è¯¥ç±»çš„å…¶ä»–æ–¹æ³•è®¿é—®ï¼Œä½†ä¸èƒ½ä»å¤–éƒ¨è®¿é—®çš„æ–¹æ³•å’Œå±æ€§ã€‚
- å¤–éƒ¨æ¥å£â€”â€”ä¹Ÿå¯ä»¥ä»ç±»çš„å¤–éƒ¨è®¿é—®çš„æ–¹æ³•å’Œå±æ€§ã€‚

å°±OOPè€Œè¨€ï¼Œ**å†…éƒ¨æ¥å£å’Œå¤–éƒ¨æ¥å£çš„åˆ’åˆ†**è¢«ç§°ä¸º**å°è£…**ã€‚

åœ¨JavaScriptä¸­ï¼Œæœ‰ä¸¤ç§ç±»å‹çš„å¯¹è±¡å­—æ®µï¼ˆå±æ€§å’Œæ–¹æ³•ï¼‰

- å…¬æœ‰çš„ï¼šå¯ä»ä»»ä½•åœ°æ–¹è®¿é—®ã€‚æ„æˆå¤–éƒ¨æ¥å£ã€‚
- ç§æœ‰çš„ï¼šåªèƒ½ä»ç±»çš„å†…éƒ¨è®¿é—®ã€‚ç”¨äºå†…éƒ¨æ¥å£ã€‚

åœ¨å…¶ä»–çš„è¯­è¨€ä¸­è¿˜å­˜åœ¨â€œå—ä¿æŠ¤â€çš„å­—æ®µï¼Œåªèƒ½ä»ç±»çš„å†…éƒ¨å’ŒåŸºäºå…¶æ‰©å±•çš„ç±»çš„å†…éƒ¨è®¿é—®ã€‚

**å—ä¿æŠ¤çš„å­—æ®µä¸æ˜¯åœ¨è¯­è¨€çº§åˆ«çš„JavaScriptä¸­å®ç°çš„ï¼Œæ˜¯æ¨¡æ‹Ÿçš„ç±»å®šä¹‰è¯­æ³•ã€‚**

**==å—ä¿æŠ¤çš„å±æ€§é€šå¸¸ä»¥ä¸‹åˆ’çº¿_ä½œä¸ºå‰ç¼€==**ã€‚

ä¸åº”è¯¥ä»å¤–éƒ¨è®¿é—®æ­¤ç±»å‹çš„å±æ€§å’Œæ–¹æ³•ã€‚

### å—ä¿æŠ¤çš„waterAmount

```js
class CoffeeMachine	{
	_waterAmount = 0;
	
	set waterAmount(value){
    if(value<0) throw new Error("negative water");
    this._waterAmount = value;
	}
	
	get waterAmount(){
    	return this._waterAmount;
  }

	constructor(power){
    	this._power = power;
  }
	
	get power(){
    return this._power;
  }
}

let coffeeMachine = new CoffeeMachine(100);
coffeeMachine.waterAmount = -10;//Error:Negative water
alert(`Power is:${coffeeMachine.power}W`);//Power is: 100W
coffeeMachine.power = 25; //Error(æ²¡æœ‰ setter)
```

#### ==å—ä¿æŠ¤çš„å­—æ®µæ˜¯å¯ä»¥è¢«ç»§æ‰¿çš„==

å¦‚æœæˆ‘ä»¬ç»§æ‰¿ class MegaMachine extends CoffeeMachine, é‚£ä¹ˆä»€ä¹ˆéƒ½æ— æ³•é˜»æ­¢æˆ‘ä»¬ä»æ–°çš„ç±»ä¸­çš„æ–¹æ³•è®¿é—®**this.\_waterAmount** æˆ– **this._power**ã€‚

### åªè¯»çš„â€œpowerâ€

**åªè¯»**ï¼šæœ‰æ—¶å€™ä¸€ä¸ªå±æ€§å¿…é¡»åªèƒ½è¢«åœ¨åˆ›å»ºæ—¶è¿›è¡Œè®¾ç½®ï¼Œä¹‹åä¸å†è¢«ä¿®æ”¹ã€‚

è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œ**æˆ‘ä»¬åªéœ€è¦è®¾ç½®getterï¼Œè€Œä¸è®¾ç½®setter**ã€‚

è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†getter/setterè¯­æ³•ã€‚

ä½†å¤§å¤šæ•°æ—¶å€™é¦–é€‰getâ€¦/setâ€¦å‡½æ•°ï¼š

```js
class CoffeeMachine{
	_waterAmount = 0;
	
	set WaterAmount(value){
		if(value<0) throw Error("Negative water");
		this._waterAmount = value;
	}
	
	get WaterAmount(){
		return this._waterAmount;
	}
}
```

ç›¸æ¯”äºgetter/setterï¼Œä»–ä»¬å¯ä»¥æ¥æ”¶å¤šä¸ªå‚æ•°ã€‚

### ç§æœ‰çš„â€œ#waterLimitâ€(éœ€è¦PolyfillğŸ˜¥)

æ­¤JavaScriptææ¡ˆä¸ºç§æœ‰å±æ€§å’Œæ–¹æ³•æä¾›è¯­è¨€çº§æ”¯æŒã€‚

ç§æœ‰å±æ€§å’Œæ–¹æ³•åº”è¯¥ä»¥#å¼€å¤´ã€‚

å®ƒä»¬åªåœ¨ç±»çš„å†…éƒ¨å¯è¢«è®¿é—®ã€‚

```js
class CoffeeMachine{
	#waterLimit = 200;
	#checkWater(value){
  	if(value < 0) throw new Error("Negative water");
		if(value > this.#waterLimit ) 
       	throw new Error("Too much water");
		}
}

let coffeeMachine = new CoffeeMachine();

//ä¸èƒ½ä»ç±»çš„å¤–éƒ¨è®¿é—®ç±»çš„ç§æœ‰å±æ€§å’Œæ–¹æ³•ã€‚
coffeeMachine.#checkWater();//Error
coffeeMachine.#waterLimit = 1000;//Error
```

åœ¨è¯­è¨€çº§åˆ«ï¼Œ#æ˜¯è¯¥å­—æ®µä¸ºç§æœ‰çš„ç‰¹æ®Šæ ‡å¿—ã€‚

**æˆ‘ä»¬æ— æ³•ä»å¤–éƒ¨æˆ–ä»ç»§æ‰¿çš„ç±»ä¸­è®¿é—®ä»–ã€‚**

**==ç§æœ‰å­—æ®µä¸å…¬å…±å­—æ®µä¸ä¼šå‘ç”Ÿå†²çª==ã€‚**æˆ‘ä»¬å¯ä»¥åŒæ—¶æ‹¥æœ‰ç§æœ‰çš„#waterAmountå’Œå…¬å…±çš„waterAmountå­—æ®µã€‚

> å’Œ java private ä¸å¤ªä¸€æ ·

å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿waterAmountæˆä¸º#waterAmountçš„ä¸€ä¸ªè®¿é—®å™¨ã€‚

```js
class CoffeeMachine{
	#waterAmount = 0;
	get waterAmount(){
		return this.#waterAmount;
	}
	
	set waterAmount(){
		if(value < 0) throw new Error("Negative water");
		this.#waterAmount = value;
	}
}

let machine = new CoffeeMachine();
machine.waterAmount = 100;
alert(machine.#waterAmount);//Error
```

ä¸å—ä¿æŠ¤çš„å­—æ®µä¸åŒï¼Œç§æœ‰å­—æ®µç”±è¯­è¨€æœ¬èº«å¼ºåˆ¶æ‰§è¡Œã€‚

ä½†æ˜¯å¦‚æœæˆ‘ä»¬ç»§æ‰¿è‡ªCoffeeMachineï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†æ— æ³•ç›´æ¥è®¿é—®#waterAmountã€‚==**æˆ‘ä»¬éœ€è¦ä¾é  waterAmount getter/setter**==:

```js
class MegaCoffeeMachine extends CoffeeMachine{
	method(){
		alert( this.#waterAmount );//Error:can only access from CoffeeMachine
	}
}
```

è¿™ç§é™åˆ¶å¤ªä¸¥é‡äº†ã€‚å¤§å¤šæ•°æ—¶å€™éƒ½ä¼šä½¿ç”¨å—ä¿æŠ¤å­—æ®µã€‚

> ä¸€æƒ³åˆ°è¿™æ˜¯åœ¨javaä¸­çš„è¯ï¼Œå€’æŒºæ­£å¸¸ã€‚

#### ğŸ˜²ç§æœ‰å­—æ®µä¸èƒ½é€šè¿‡this[name]è®¿é—®

```js
class User{
	sayHi(){
		let fieldName = "name";
		alert(`Hello,${this[fieldName]}`);
	}
}
```

æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨this[name]è®¿é—®å­—æ®µï¼Œ

ä½†å¯¹äºç§æœ‰å­—æ®µæ¥è¯´ï¼Œè¿™æ˜¯ä¸å¯èƒ½çš„ï¼šthis[â€˜#nameâ€™]ä¸èµ·ä½œç”¨ã€‚

## æ‰©å±•å†…å»ºç±»

å†…å»ºçš„ç±»ï¼Œä¾‹å¦‚Array,Mapç­‰ä¹Ÿéƒ½æ˜¯å¯ä»¥æ‰©å±•çš„ã€‚

```js
class PowerArray extends Array{
  isEmpty(){
    return this.length === 0;
  }
}

let arr = new PowerArray(1,2,5,10,50);
alert(arr.isEmpty()); //false

let filteredArr = arr.filter(item => item >= 10);
alert(filteredArr);//10,50
alert(filteredArr.isEmpty());//false
```

**å†…å»ºçš„æ–¹æ³•ä¾‹å¦‚ filterï¼Œmap ç­‰ï¼Œè¿”å›çš„æ­£æ˜¯å­ç±» PowerArray çš„æ–°å¯¹è±¡ã€‚**

ä»–ä»¬å†…éƒ¨ä½¿ç”¨äº†==**å¯¹è±¡çš„constructorå±æ€§**==æ¥å®ç°è¿™ä¸€åŠŸèƒ½ã€‚

arr.constructor === PowerArray

> å¯¹è±¡çš„æ„é€ å™¨å±æ€§constructoræ˜¯arr.\__proto__.constructor

å½“arr.filter()è¢«è°ƒç”¨æ—¶ï¼Œå®ƒçš„å†…éƒ¨ä½¿ç”¨çš„æ˜¯arr.constructoræ¥åˆ›å»ºæ–°çš„ç»“æœæ•°ç»„ï¼Œè€Œä¸æ˜¯ä½¿ç”¨åŸç”Ÿçš„ Arrayã€‚å› è€Œæˆ‘ä»¬å¯ä»¥åœ¨ç»“æœæ•°ç»„ä¸Šç»§ç»­ä½¿ç”¨PowerArrayçš„æ–¹æ³•ã€‚

å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å®šåˆ¶è¿™ç§è¡Œä¸ºã€‚

å¦‚æœæˆ‘ä»¬å¸Œæœ›åƒ map æˆ– filter è¿™æ ·çš„å†…å»ºæ–¹æ³•**è¿”å›å¸¸è§„æ•°ç»„**ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨==**Symbol.species ä¸­è¿”å› Array**==ã€‚

```js
class PowerArray extends Array{
	isEmpty(){
    	return this.length === 0;
  }
  /**/
  static get [Symbol.species](){
    return Array;
  }
  /**/
}

let arr = new PowerArray(1,2,5,10,50);
alert(arr.isEmpty()); //false

let filteredArr = arr.filter(item => item >= 10);

alert(filteredArr.isEmpty());//Error:filteredArr.isEmpty is not a function
```

**filter ä½¿ç”¨ ==arr.constructor[Symbol.species]== ä½œä¸º constructor åˆ›å»ºæ–°æ•°ç»„ã€‚**

å…¶ä»–é›†åˆçš„å·¥ä½œæ–¹å¼ç±»ä¼¼ã€‚ä¾‹å¦‚ **Map å’Œ Set**ã€‚

### å†…å»ºç±»æ²¡æœ‰é™æ€æ–¹æ³•ç»§æ‰¿

å†…å»ºå¯¹è±¡æœ‰ä»–ä»¬è‡ªå·±çš„é™æ€æ–¹æ³•ï¼Œä¾‹å¦‚Object.keysï¼ŒArray.isArrayç­‰ã€‚

å¦‚æˆ‘ä»¬æ‰€çŸ¥é“çš„ï¼ŒåŸç”Ÿçš„ç±»äº’ç›¸æ‰©å±•ã€‚ä¾‹å¦‚Arrayæ‰©å±•è‡ªObjectã€‚

é€šå¸¸ï¼Œå½“ä¸€ä¸ªç±»æ‰©å±•å¦ä¸€ä¸ªç±»æ—¶ï¼Œé™æ€æ–¹æ³•å’Œéé™æ€æ–¹æ³•éƒ½ä¼šè¢«ç»§æ‰¿ã€‚ä½†å†…å»ºç±»æ˜¯ä¸€ä¸ªæ„å¤–ï¼Œ==**ä»–ä»¬ç›¸äº’é—´ä¸ç»§æ‰¿é™æ€æ–¹æ³•**==ã€‚

Array å’Œ Dateéƒ½ç»§æ‰¿è‡ª Objectï¼Œæ‰€ä»¥å®ƒä»¬çš„å®ä¾‹éƒ½æœ‰æ¥è‡ªObject.prototypeçš„æ–¹æ³•ã€‚ä½†**Array.[[Prototype]]å¹¶ä¸æŒ‡å‘Object**ï¼Œæ‰€ä»¥æ²¡æœ‰ä¾‹å¦‚Array.keys(),æˆ–Date.keys()çš„é™æ€æ–¹æ³•ã€‚

<img src="C:\Users\Zirina\AppData\Roaming\Typora\typora-user-images\image-20211210213929162.png" alt="image-20211210213929162" style="zoom:67%;" />

## ç±»æ£€æŸ¥ï¼šâ€œinstanceofâ€

instanceofæ“ä½œç¬¦ç”¨äºæ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å±äºæŸä¸ªç‰¹å®šçš„classã€‚åŒæ—¶ï¼Œå®ƒè¿˜è€ƒè™‘äº†ç»§æ‰¿ã€‚

è®¸å¤šæƒ…å†µä¸‹å¯èƒ½éƒ½éœ€è¦è¿›è¡Œæ­¤ç±»æ£€æŸ¥ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥è¢«ç”¨æ¥æ„å»ºä¸€ä¸ª**å¤šæ€æ€§**çš„å‡½æ•°ï¼Œæ ¹æ®å‚æ•°çš„ç±»å‹å¯¹å‚æ•°è¿›è¡Œä¸åŒçš„å¤„ç†ã€‚

### instanceofæ“ä½œç¬¦

```js
class Rabbit{}
let rabbit = new Rabbit();

alert(rabbit instanceof Rabbit);//true
```

å¦‚æœobjéš¶å±äºClassç±»ï¼ˆæˆ–Classçš„å»¶ä¼¸ç±»ï¼‰ï¼Œåˆ™è¿”å›trueã€‚

> å’Œjavaä¸€æ ·ï¼Œ åˆ¤æ–­å·¦è¾¹æ˜¯ä¸æ˜¯å±äºå³è¾¹çš„ç±» æˆ–æ˜¯ å…¶å­ç±»

å¯ä»¥ä¸æ„é€ å‡½æ•°ä¸€èµ·ä½¿ç”¨ï¼ˆClassä¹Ÿå¯ä»¥ï¼‰ï¼š

```js
function Rabbit(){}
alert(new Rabbit() instanceof Rabbit);
```

ä¸Arrayä¹‹ç±»çš„å†…å»ºclassä¸€èµ·ä½¿ç”¨ï¼š

```js
let arr = [1, 2, 3];
alert( arr instanceof Array);//true
alert( arr instanceof Object);//true
```

instanceof é»˜è®¤æ ¹æ®åŸå‹é“¾è¿›è¡Œæ£€æŸ¥ï¼Œ

æ­¤å¤–ï¼Œå¯ä»¥åœ¨é™æ€æ–¹æ³•Symbol.hasInstanceä¸­è®¾ç½®è‡ªå®šä¹‰é€»è¾‘ã€‚

**obj instanceof Class çš„ç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹å¤§è‡´å¦‚ä¸‹**

1. å¦‚æœæœ‰é™æ€æ–¹æ³•Symbol.hasInstanceï¼Œé‚£ä¹ˆç›´æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚

   ```js
   class Animal {
   	static [Symbol.hasInstance](obj){
   		if(obj.canEat) return true;
   	}
   }
   
   let obj = { canEat:true };
   
   alert(obj instanceof Animal); // true
   ```

2. å¤§å¤šæ•° class æ²¡æœ‰ Symbol.hasInstanceã€‚<br>æ ‡å‡†é€»è¾‘æ˜¯ä½¿ç”¨obj instanceOf Classæ£€æŸ¥ Class.prototype<br>æ˜¯å¦ç­‰äºobjçš„åŸå‹é“¾ä¸­çš„åŸå‹ä¹‹ä¸€ã€‚

   > mdnä¸Šæ˜¯è¯´æ£€æŸ¥constructor.prototypeæ˜¯å¦å­˜åœ¨äºå‚æ•°objectçš„åŸå‹é“¾ä¸Šã€‚

   ```js
   obj.__proto__ === Class.prototype?
   obj.__proto__.__proto__ === Class.prototype?
   obj.__proto__.__proto__.__proto__ === Class.prototype?
   ```

   å¦‚æœæ£€æŸ¥åˆ°äº†åŸå‹é“¾çš„å°¾ç«¯ï¼Œåˆ™è¿”å›falseã€‚

   <img src="C:\Users\Zirina\AppData\Roaming\Typora\typora-user-images\image-20211223200636152.png" alt="image-20211223200636152" style="zoom: 67%;" />

å¦å¤–ä¸€ä¸ªæ–¹æ³• **objA.isPrototypeOf(objB)** 

å¦‚æœobjAå¤„åœ¨objBçš„åŸå‹é“¾ä¸­ï¼Œåˆ™è¿”å›trueã€‚

æ‰€ä»¥ï¼Œå¯ä»¥å°†obj instanceof Classæ£€æŸ¥ æ”¹ä¸º Class.prototype.isPrototypeOf(obj)ã€‚

Classçš„constructorè‡ªèº«ä¸å‚ä¸æ£€æŸ¥ï¼Œæ£€æŸ¥è¿‡ç¨‹åªå’ŒåŸå‹é“¾åŠClass.prototypeæœ‰å…³ã€‚

> é™æ€æ–¹æ³•çš„é“¾ä¸å±äºåŸå‹é“¾ï¼Ÿ

```js
alert(Rabbit.isPrototypeOf(new Rabbit()));//false
alert(Rabbit.prototype.isPrototypeOf(new Rabbit()));//true
```

```js
function Rabbit(){}
let rabbit = new Rabbit();

//ä¿®æ”¹äº†prototype
Rabbit.prototype = {};

alert( rabbit instanceof Rabbit); //false
```

### ä½¿ç”¨Object.prototype.toString æ–¹æ³•æ¥æ­ç¤ºç±»å‹

```js
let obj = {};

alert(obj); //[object Object];
alert(obj.toString());//åŒä¸Š
```

è¿™é‡Œæ˜¯é€šè¿‡toStringæ–¹æ³•å®ç°çš„ã€‚

å†…å»ºçš„toStringæ–¹æ³•å¯ä»¥è¢«ä»å¯¹è±¡ä¸­æå–å‡ºæ¥ï¼Œå¹¶åœ¨ä»»ä½•å…¶ä»–å€¼çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œã€‚

<img src="C:\Users\Zirina\AppData\Roaming\Typora\typora-user-images\image-20211223213352510.png" alt="image-20211223213352510" style="zoom:80%;" />

#### Symbol.toStringTag

å¯ä»¥ä½¿ç”¨ç‰¹æ®Šçš„**å¯¹è±¡å±æ€§** **==Symbol.toStringTag==**è‡ªå®šä¹‰å¯¹è±¡çš„toStringæ–¹æ³•çš„è¡Œä¸ºã€‚

> æœ‰ç‚¹åƒJava çš„é‡å†™ toStringæ–¹æ³•
>
> ä½†è¿™é‡Œæ˜¯é’ˆå¯¹å•ä¸ªå¯¹è±¡
>
> ä¹Ÿå¯ä»¥é’ˆå¯¹æ•´ä¸ªç±»ï¼Œå†™åœ¨class.prototype[Symbol.toStringTag]å³å¯ã€‚

```js
let user = {
	[Symbol.toSrtringTag]:"User"
};

alert({}.toString.call(user));
```

ç‰¹å®šäºç¯å¢ƒçš„å¯¹è±¡å’Œç±»çš„toStringTag

```js
alert(window[Symbol.toStringTag]);//Window
alert(XMLHttpRequest.prototype[Symbol.toStringTag]);//XMLHttpRequest

alert( {}.toString.call(window));//[object Window]
alert({}.toString.call(new XMLHttpRequest()));//[object XMLHttpRequest]
```

è¿™ç§å‡çº§ç‰ˆtypeofä¸ä»…èƒ½**æ£€æŸ¥åŸå§‹æ•°æ®ç±»å‹**ï¼Œè€Œä¸”é€‚ç”¨äºå†…å»ºå¯¹è±¡ï¼Œè¿˜æ”¯æŒè‡ªå®šä¹‰ã€‚

> instanceofä¸èƒ½ç”¨äºæ£€æŸ¥åŸå§‹ç±»å‹ï¼Œåªèƒ½ç”¨äºæ£€æŸ¥å¼•ç”¨ç±»å‹ã€‚

å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬å…ˆè¦è·å–å†…å»ºå¯¹è±¡çš„ç±»å‹ï¼Œå¹¶é€šè¿‡å­—ç¬¦ä¸²çš„å½¢å¼è¿”å›ï¼Œè€Œä¸åªæ˜¯æ£€æŸ¥ç±»å‹çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨{}.toString.call ä»£æ›¿ instanceofã€‚

### æ€»ç»“

|             | ç”¨äº                                                     | è¿”å›å€¼     |
| :---------- | -------------------------------------------------------- | ---------- |
| typeof      | åŸå§‹æ•°æ®ç±»å‹                                             | string     |
| {}.toString | åŸå§‹æ•°æ®ç±»å‹ï¼Œå†…å»ºå¯¹è±¡ï¼ŒåŒ…å«Symbol.toStringTagå±æ€§çš„å¯¹è±¡ | string     |
| instanceof  | å¯¹è±¡                                                     | true/false |

å½“æˆ‘ä»¬æƒ³å¯¹ç±»è¿›è¡Œæ£€æŸ¥ï¼ŒåŒæ—¶è€ƒè™‘**ç»§æ‰¿**æ—¶ï¼Œinstanceofæ›´åˆé€‚ã€‚

instanceofä¸å…³å¿ƒæ„é€ å‡½æ•°ï¼ŒçœŸæ­£å†³å®šçš„æ˜¯prototypeã€‚

## Mixinæ¨¡å¼

åœ¨JavaScriptä¸­ï¼Œæˆ‘ä»¬åªèƒ½ç»§æ‰¿å•ä¸ªå¯¹è±¡ã€‚æ¯ä¸ªå¯¹è±¡åªèƒ½æœ‰ä¸€ä¸ª[[Prototype]]ã€‚

å¦‚æœæˆ‘ä»¬æƒ³è¦ä¸¤ä¸ªç±»çš„mixinï¼Œæˆ–è€…ï¼Œ

æˆ‘ä»¬æœ‰ä¸€ä¸ªUserç±»å’Œä¸€ä¸ªEventEmitterç±»æ¥å®ç°äº‹ä»¶ç”Ÿæˆï¼Œå¹¶ä¸”æˆ‘ä»¬æƒ³å°†EventEmitterçš„åŠŸèƒ½æ·»åŠ åˆ°Userä¸­ï¼Œä»¥ä¾¿æˆ‘ä»¬çš„ç”¨æˆ·å¯ä»¥è§¦å‘äº‹ä»¶ã€‚

mixinæ˜¯ä¸€ä¸ªåŒ…å« å¯è¢«å…¶ä»–ç±»ä½¿ç”¨è€Œ**æ— éœ€ç»§æ‰¿**çš„**æ–¹æ³•** çš„ç±»ã€‚

> javaæ¥å£ï¼Ÿ

### ä¸€ä¸ªMixinå®ä¾‹

åœ¨JavaScriptä¸­æ„é€ ä¸€ä¸ªmixinæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯æ„é€ ä¸€ä¸ªæ‹¥æœ‰å®ç”¨æ–¹æ³•çš„å¯¹è±¡ã€‚

æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°å°†è¿™äº›å®ç”¨çš„æ–¹æ³•åˆå¹¶åˆ°ä»»ä½•ç±»çš„åŸå‹ä¸­ã€‚

```js
let sayHiMixin = {
	sayHi(){
		alert(`Hello ${this.name}`);
	},
		sayBye(){
		alert(`Bye ${this.name}`);
	},
};

class User {
  	constructor(name){
      this.name = name;
    }
}
//æ‹·è´æ–¹æ³•
Object.assign(User.prototype,sayHiMixin);
new User("Morty").sayHi(); //Hello Morty
```

æ²¡æœ‰ç»§æ‰¿ï¼Œåªæœ‰ç®€å•çš„æ–¹æ³•æ‹·è´ã€‚æ‰€ä»¥Userå¯ä»¥ä»å¦ä¸€ä¸ªç±»ç»§æ‰¿ï¼Œè¿˜å¯ä»¥é€šè¿‡mixinæ¥â€œmix-inâ€å…¶ä»–æ–¹æ³•ã€‚

<img src="C:\Users\Zirina\AppData\Roaming\Typora\typora-user-images\image-20211223220143099.png" alt="image-20211223220143099" style="zoom:80%;" />

**Object.assign**ä¼šè¿›è¡Œ**æµ…æ‹·è´**ï¼Œ

å¯ä»¥é€šè¿‡ **JSON.parse(JSON.stringify(obj1))** è¿›è¡Œ**æ·±æ‹·è´**ã€‚

Mixinå¯ä»¥åœ¨è‡ªå·±çš„å†…éƒ¨ä½¿ç”¨ç»§æ‰¿ã€‚

```js
let sayMixin = {
	say(phrase){
		alert(phrase);
	}
};

let sayHiMixin = {
  __proto__:sayMixin,//æˆ–ä½¿ç”¨Object.createæ¥è®¾ç½®åŸå‹
  
  sayHi(){
    super.say(`Hello ${this.name}`);
  },
   sayBye(){
    super.say(`Bye ${this.name}`);
  },
};

class User{
  	constructor(name){
      	this.name = name;
    }
}

Object.assign(User.prototype,sayHiMixin);
new User("Zirina").sayHi(); //Hello,Zirina
```

sayHiMixinå†…éƒ¨å¯¹çˆ¶ç±»æ–¹æ³•super.say()çš„è°ƒç”¨ ä¼šåœ¨**mixinçš„åŸå‹**ä¸­æŸ¥æ‰¾æ–¹æ³•ï¼Œè€Œä¸æ˜¯åœ¨classä¸­æŸ¥æ‰¾ã€‚

<img src="C:\Users\Zirina\AppData\Roaming\Typora\typora-user-images\image-20211223221516700.png" alt="image-20211223221516700" style="zoom:80%;" />

è¿™æ˜¯å› ä¸ºæ–¹æ³•sayHiå’ŒsayByeæœ€åˆæ˜¯åœ¨sayHiMixinä¸­åˆ›å»ºçš„ã€‚

å› æ­¤ï¼Œå³ä½¿å¤åˆ¶äº†ä»–ä»¬ï¼Œä½†æ˜¯ä»–ä»¬çš„**[[HomeObject]]å†…éƒ¨å±æ€§ä»å¼•ç”¨çš„æ˜¯sayHiMixin**ã€‚

superåœ¨[[HomeObject]].[[Prototype]]ä¸­æŸ¥æ‰¾çˆ¶æ–¹æ³•æ—¶ï¼Œæ„å‘³ç€å®ƒæœç´¢çš„æ˜¯sayHiMixin.[[Prototype]]ï¼Œè€Œä¸æ˜¯User.[[Prototype]]ã€‚



### EventMixin

éœ€è¦æµè§ˆå™¨å¯¹è±¡çš„ä¸€ä¸ªé‡è¦åŠŸèƒ½æ˜¯å®ƒä»¬å¯ä»¥ç”Ÿæˆäº‹ä»¶ã€‚

æˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªmixinï¼Œå°†ä¸äº‹ä»¶ç›¸å…³çš„å‡½æ•°æ·»åŠ åˆ°ä»»æ„class/objectä¸­ã€‚

- Mixinå°†æä¾› **.trigger(name,[â€¦data])** æ–¹æ³•ï¼Œåœ¨å‘ç”Ÿé‡è¦äº‹æƒ…æ—¶ç”Ÿæˆä¸€ä¸ªäº‹ä»¶ã€‚
  - name : äº‹ä»¶çš„åç§°
  - [â€¦data]ï¼šå¯é€‰çš„å¸¦æœ‰äº‹ä»¶æ•°æ®çš„å…¶ä»–å‚æ•°ï¼ˆargumentsï¼‰
- **.on(name,handle)** æ–¹æ³•ï¼Œä¸ºå…·æœ‰ç»™å®šåç§°çš„äº‹ä»¶æ·»åŠ äº†**handle**å‡½æ•°ä½œä¸ºç›‘å¬å™¨ã€‚å½“å…·æœ‰ç»™å®šnameçš„äº‹ä»¶è§¦å‘æ—¶å°†è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå¹¶ä»**.trigger**è°ƒç”¨ä¸­è·å–å‚æ•°ã€‚
- **.off(name,handle)** åˆ é™¤handleç›‘å¬å™¨ã€‚

æ·»åŠ å®Œmixinåï¼Œå¯¹è±¡userå°†èƒ½å¤Ÿåœ¨è®¿å®¢ç™»å½•æ—¶ç”Ÿæˆäº‹ä»¶â€œloginâ€ã€‚

å¦ä¸€ä¸ªå¯¹è±¡ï¼Œä¾‹å¦‚calendarå¯èƒ½å¸Œæœ›ç›‘å¬æ­¤ç±»äº‹ä»¶ä»¥ä¾¿ä¸ºç™»å½•çš„äººåŠ è½½æ—¥å†ã€‚

æˆ–å½“ä¸€ä¸ªèœå•é¡¹è¢«é€‰ä¸­æ—¶ï¼Œmenuå¯ä»¥ç”Ÿæˆâ€œselectâ€äº‹ä»¶ï¼Œå…¶ä»–å¯¹è±¡å¯ä»¥åˆ†é…å¤„ç†ç¨‹åºå·²å¯¹è¯¥äº‹ä»¶åšå‡ºååº”ã€‚



```js
let eventMixin = {
	/**
	 * è®¢é˜…äº‹ä»¶ï¼Œç”¨æ³•ï¼š
	 * menu.on('select',function(item){...})
	*/
	on(eventName, handler){
    if(!this._eventHandlers) this._eventHandlers = {};
    else if(!this._eventHandlers[eventName]) this._eventHandlers[eventName] = [];
    this.__eventHandlers[eventName].push(handler);
    //è§¦å‘äº‹ä»¶æ—¶ï¼Œå°†è¦æ‰§è¡Œçš„æ–¹æ³•ä½¿ç”¨æ•°ç»„å­˜å‚¨
  },
  
  /**
   * å–æ¶ˆè®¢é˜…ï¼Œç”¨æ³•ï¼š
   *	menu.off('select',handler)
   */
  off(eventName,handler){
    let handlers = this._eventHandlers?.[eventName];
    if(!handlers) return;
    for(let i = 0; i < handlers.length; i++){
      	if(handlers[i] === handler){
          handlers.splice(i--,1); //åˆ é™¤æŒ‡å®šçš„handler
        }
    }
  },
  
  /**
   * ç”Ÿæˆå…·æœ‰ç»™å®šåç§°å’Œæ•°æ®çš„äº‹ä»¶
   * this.trigger('select',data1, data2);
   */
  trigger(eventName,...args){
    if(!this._eventHandlers?.[eventName]){
      return;
    }
    // è°ƒç”¨äº‹ä»¶å¤„ç†ç¨‹åº(handler)
    this._eventHandlers[eventName].forEach(handler => handler.apply(this,args));
    //forEach(item,index,array)
  }
};
```

1. **.on(eventName, handler) ** æŒ‡å®šå‡½æ•°handlerä»¥åœ¨å…·æœ‰å¯¹åº”åç§°çš„äº‹ä»¶å‘ç”Ÿæ—¶è¿è¡Œã€‚ä»æŠ€æœ¯ä¸Šè®²ï¼Œè¿™å„¿æœ‰ä¸€ä¸ªç”¨äºå­˜å‚¨æ¯ä¸ªäº‹ä»¶åç§°å¯¹åº”çš„å¤„ç†ç¨‹åºï¼ˆhandlerï¼‰çš„_eventHandlerså±æ€§ï¼Œåœ¨è¿™å„¿è¯¥å±æ€§å°±ä¼šå°†æŒ‡å®šçš„è¿™ä¸ªhandleræ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚
2. **.off(eventName, handler)** ä»å¤„ç†ç¨‹åºåˆ—è¡¨ä¸­åˆ é™¤æŒ‡å®šçš„å‡½æ•°ã€‚
3. **.trigger(eventName, â€¦args)** ç”Ÿæˆäº‹ä»¶ï¼šæ‰€æœ‰_eventHandlers[eventName]ä¸­çš„**äº‹ä»¶å¤„ç†ç¨‹åºï¼ˆhandlerï¼‰éƒ½è¢«è°ƒç”¨**ï¼Œå¹¶ä¸” **â€¦args ä¼šè¢«ä½œä¸ºå‚æ•°**ä¼ é€’ç»™å®ƒä»¬ã€‚

ç”¨æ³•ï¼š

```js
class Menu{
	choose(value){
		this.trigger("select",value);//*
	}
}
//æ·»åŠ å¸¦æœ‰äº‹ä»¶ç›¸å…³æ–¹æ³•çš„mixin
Object.assign(Menu.prototype, eventMixin);
let menu = new Menu();

//æ·»åŠ ä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºï¼Œåœ¨è¢«é€‰æ‹©æ—¶è°ƒç”¨
menu.on("select",value => alert(`Value selected:${value}`));

//è§¦å‘äº‹ä»¶
menu.choose("123");
```

ä½¿ç”¨eventMixinå¯ä»¥è½»æ¾åœ°å°†æ­¤ç±»è¡Œä¸ºæ·»åŠ åˆ°æˆ‘ä»¬æƒ³è¦çš„å¤šä¸ªç±»ä¸­ï¼Œå¹¶ä¸”ä¸ä¼šå½±å“ç»§æ‰¿é“¾ã€‚

**Mixinså¯èƒ½ä¼šæ„å¤–è¦†ç›–æ‰ç°æœ‰ç±»çš„æ–¹æ³•ã€‚**