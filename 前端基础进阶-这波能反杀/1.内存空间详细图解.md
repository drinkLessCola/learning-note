# 内存空间详细图解

## 一、栈数据结构

JavaScript 中的 **基础数据类型** 在栈内存中维护，**引用数据类型** 在堆内存中维护。

栈内存与堆内存没有本质区别，不过栈内存是从地址高位开始分配，堆内存从地址低位开始分配。

JavaScript 中的执行上下文基于栈实现。

## 二、堆数据结构

堆数据结构是一种树状结构。可以无序存储数据。

## 三、队列

事件循环（Event Loop） 机制基于队列实现。

## 四、变量对象与基础数据类型

JavaScript的执行上下文生成之后，会创建一个叫做变量对象的特殊对象，JavaScript的基础数据类型往往都会保存在变量对象中。

基础数据类型都是按值访问，我们可以直接操作保存在变量中的实际值。

## 五、引用数据类型与堆内存

引用数据类型的值是保存在堆内存中的对象。

 JavaScript 不允许直接访问堆内存中的数据，因此我们不能直接操作对象的堆内存空间。操作对象时，实际上操作的是对象的引用。

因此，引用类型的值是按引用访问的。

可以将引用理解为保存在变量对象中的一个地址，该地址与堆内存的实际值相关联。

```js
var a1 = 0;   // 变量对象
var a2 = 'this is string'; // 变量对象
var a3 = null; // 变量对象

var b = { m: 20 }; // 变量b存在于变量对象中，{m: 20} 作为对象存在于堆内存中
var c = [1, 2, 3]; // 变量c存在于变量对象中，[1, 2, 3] 作为对象存在于堆内存中
```

![image-20220818211531433](C:\Users\Zirina\AppData\Roaming\Typora\typora-user-images\image-20220818211531433.png)

当我们要访问堆内存中的引用数据类型时，实际上我们首先是从变量对象中获取了该对象的地址引用，然后再从堆内存中取得我们需要的数据。

### 值复制

基本数据类型会直接将值复制一份，两个值之间没有任何关联。

引用数据类型也会将值复制一份，不过此时的值为指向堆内存空间的地址，因此实际上复制的是地址。两个变量虽然相互独立，但最终指向了堆中的同一个对象。

