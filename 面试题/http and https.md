## 1. HTTP 和 HTTPS

### 1. http 和 https 的基本概念

- http：是超文本传输协议，规定了客户端与服务器端通信的标准。
- https：是超文本传输安全协议，在 HTTP 下加入 SSL 层进行加密，建立一个信息安全通道。
  - 信息加密：内容进行对称加密，每一次链接都生成一个唯一的加密密钥
  - 数据完整性：数据传输会经过完整性校验。
  - 身份认证：第三方无法伪造客户端身份。

<img src="C:\Users\Zirina\AppData\Roaming\Typora\typora-user-images\image-20220522163310910.png" alt="image-20220522163310910" style="zoom:80%;" />

### 2. http 和 https 的区别及优缺点

- 安全性：https 需要用到ssl/tls证书，比 http 安全。
  - http 是超文本传输协议，信息通过**明文传输**，有被**窃听、篡改、冒充**的风险。
  - https 是具有安全性的 ssl 加密传输协议，比 http 协议安全。
    - 可以防止数据在传输过程中被窃取，改变，通过签名确认还可以确保数据的完整性
- 默认端口：http 为 80， https 为 443
- http 的连接很简单，是无状态的。https 握手阶段比较费时，页面加载时间更长。
- https 缓存不如 http 高效，会增加数据开销。
- https 协议需要 ca 证书
- https 对搜索引擎更友好，利于 SEO

### 3.https 协议的工作原理

1. 客户端使用 https url 访问服务器，要求服务器建立 ssl 连接
2. 服务器接收到客户端的请求之后，会将网站的 **证书**（包含了公钥）传输给客户端。
3. 客户端和服务器端开始**协商 ssl 链接的安全等级**，即**加密等级**。
4. 客户端浏览器通过双方协商一致的安全等级，创建**会话秘钥**，通过网站的公钥加密会话秘钥，并传送给服务器。
5. 服务器通过自己的 **私钥** 解密出会话秘钥
6.  服务器通过会话秘钥加密与客户端之间的通信。

## http 的三大安全风险

http 协议是明文传送，所以存在三大风险：

1. 被**窃听**的风险：第三方可以截获并**查看**你的内容
2. 被**篡改**的风险：第三方可以截获并**修改**你的内容
3. 被**冒充**的风险：第三方可以伪装成通信方与你通信

## 非对称性加密算法 RSA

非对称性加密算法 RSA 是内容加密的一类算法，它有两个密钥：**公钥和私钥**。

- 公钥是公开的钥匙，所有人都可以知道。
- 私钥是保密的，只有持有者知道
- 通过公钥加密的内容，只能通过私钥解开。

安全性很高，但因为计算量庞大，比较消耗性能。

### 通过数字签名进行认证的过程

发送方通过**散列函数**对内容进行处理（比如**哈希**），得到的**消息摘要**再用**私钥加密**，作为**数字签名**。

将内容明文与数字签名一起发送。

接收方使用公钥解密签名得到一个消息摘要，并对内容明文进行同样的算法处理得到一个消息摘要，比较两个消息摘要即可验证信息的完整性。

## HTTPS 通信过程

HTTPS 协议由 HTTP 协议和 SSL/TLS 协议组成。

SSL / TLS 是负责加密解密等安全处理的模块。

1. 浏览器往服务器的 443 端口发起请求，请求携带了**浏览器支持的加密算法和哈希算法**。
2. 服务器收到请求，选择浏览器支持的加密算法和哈希算法。
3. 服务器将数字证书返回给浏览器
   - 数字证书可以是向某个可靠机构申请的，也可以是自制的。
4. 浏览器进入数字证书认证环节，这一部分是浏览器内置的 TLS 完成的：
   - 浏览器从内置的证书列表中索引，找到服务器下发证书对应的机构
     - 如果没有找到，提示用户该证书不是由权威机构颁发，是不可信任的。
     - 如果找到了对应的机构，取出该机构颁发的公钥。
   - 用机构的公钥解密得到证书的内容和签名，验证证书签名的合法性。
     - 证书的内容包括：网站网址，网站公钥，证书的有效期
   - 检查证书是否过期 以及 证书记录的网址是否和当前网址是一致。网址不一致 / 证书过期会提示用户。
5. *** **浏览器生成一个随机数 R， 并使用网站**公钥**对 R 进行加密
6. *** **浏览器将加密的 R 传送给服务器，服务器使用**私钥**解密
7. 服务器**以 R 为密钥**使用与浏览器协商的**对称加密算法**加密网页内容并传输给浏览器
8. 浏览器以 R 为密钥使用之前约定好的**解密算法**获取网页内容。

### 非对称性加密算法只用到了一次

非对称加密算法计算量较大，整个通信过程只会用到一次。用于保护传输客户端生成的**用于对称加密的随机数密钥。**

后续内容的加解密都是通过一开始约定好的**对称加密算法**进行的。

### TLS 的前身是 SSL

TLS 1.0 = SSL 3.1

TLS 1.1 = SSL 3.2

SSL / TLS 建立在 TCP 协议之上，属于应用层级别的协议。

包括 TLS Record Protocol 和 TLS Handshaking Protocols 两个模块。

- TLS Record Protocol 保证数据传输过程中的完整性和私密性。
- TLS Handshaking Protocols 负责握手过程中的身份认证





## TLS/SSL

全称安全传输协议 Transport Layer Security ，是介于 TCP 与 HTTP 之间的一层安全协议。

功能的实现依赖于三类基本算法：

- 散列函数、Hash
- 对称加密
- 非对称加密

**非对称性加密**实现 **身份认证** 和 **密钥协商**

**对称加密**采用协商的算法对数据加密

**散列函数**验证信息的完整性

<img src="C:\Users\Zirina\AppData\Roaming\Typora\typora-user-images\image-20220522163916812.png" alt="image-20220522163916812" style="zoom:80%;" />

### 散列函数 Hash

- 常见算法： MD5、SHA1、SHA256
- 特点：
  - 函数单向不可逆
  - 对输入非常敏感，针对数据的任何修改都会改变函数结果
  - 输出长度固定
- 作用：
  - 用于防止信息篡改并验证数据的完整性。

散列函数不能单独实现信息防篡改，因为数据是明文传输的

中间人可以修改信息之后，重新计算信息摘要。

因此 **需要对传输的 ==信息摘要== 进行私钥加密** 得到**数字签名**。才能保证数据的完整性。

<img src="C:\Users\Zirina\AppData\Roaming\Typora\typora-user-images\image-20220522164727237.png" alt="image-20220522164727237" style="zoom:80%;" />

<img src="C:\Users\Zirina\AppData\Roaming\Typora\typora-user-images\image-20220522165004819.png" alt="image-20220522165004819" style="zoom:80%;" />

### 对称加密

- 常见算法: AES-CBC 、DES、3DES、AES-GCM
- 特点：
  - 使用相同的密钥进行信息的加密与解密
  - 1对1通信
- 作用：防止信息窃听。

### 非对称加密

- 常见： RSA、ECC、DH
- 特点：
  - 密码成对出现，分为公钥和私钥
  - 公钥加密的信息只能私钥解开，私钥加密的信息只能公钥解开
    - 因此掌握公钥的不同客户端之间不能互相解密信息。
    - 只能与掌握私钥的服务器加密通信
  - 算法复杂，加密速度慢
- 作用：
  - 服务器可以实现1对多的通信，
    - 只需维持一个私钥就能够和多个客户端加密通信
    - 发出的信息可以被所有客户端解密
  - 客户端也可以验证掌握私钥的服务器的身份

### SSL/TLS 工作原理

- 客户端使用非对称性加密与服务器通信获取数字证书（公钥信息），实现身份验证。
- 客户端身份验证成功后，协商对称加密使用的密钥。
- 使用对称加密算法对信息及信息摘要进行加密

