# url 输入 -> 页面渲染完毕的过程

## 1. DNS 解析

DNS 解析：一个域名转换为对应 IP 地址的过程 

寻找 哪台机器拥有我们需要的资源。

### 1.1 DNS 如何查询

1. 浏览器首先搜索**浏览器自身缓存的 DNS 记录**。
2. 如果浏览器缓存中没有找到需要的记录 / 记录已经过期，则搜索 **host文件** 和 **操作系统缓存**
3. 如果在 host文件 和 操作系统缓存中没有找到需要的 DNS 记录或记录已经过期，则向 **域名解析服务器** 发送 **解析请求**。
4. 如果域名解析服务器也没有该域名的记录，则开始  **递归+迭代解析**。
5. 获取域名对应的 IP 地址后，返回给浏览器。

## 2. TCP 连接

### 2.1 TCP 三次握手

- 客户端向服务器发送一个**建立连接**的请求。
  - 发出客户端 seq:seq=client_isn
- 服务器收到请求后**发送同意连接**的信号。
  - 返回 ack=client_isn+1 和服务器端seq: seq=server_isn
- 主机收到同意连接的信号后，再次向服务器**发送确认信号**。
  - 返回 ack=server_isn+1

至此，主机与服务器建立了连接。

TCP 协议可以保证信息传输的可靠性

- 三次握手的过程中，若一方收不到确认信号，协议会要求重新发送信号。

需要发送第三次请求的原因：

- 只有通过三次通信，才能确保服务器和客户端都能正常接收对方的消息。
  - 如果没有第三次握手，只能确定服务器端可以正常接收客户端的消息，但是不能确保客户端能够正常接收服务端的消息。
- 已失效的连接请求报文段情况：
  - 客户端发出第一个连接请求的报文段并没有丢失，而是在某个网络节点长时间滞留了。
  - 延误到连接释放后的某个时间才到达 服务器端。
  - 服务器端收到失效的连接请求后，误认为是客户端再次发出的一个新的连接请求，就向客户端发出确认报文段同意请求
  - 如果不采用三次握手，那么此时**新的连接已经建立**，而此时客户端没有发出建立连接的请求，也就不会向服务器端发送数据。服务器端会认为连接已经建立，并一直准备接收数据，造成**资源浪费**。

## 3.发起 HTTP 请求

客户端与服务器端建立连接后，便可以进行通信。

浏览器根据 url 内容生成 HTTP 请求。

HTTP 请求由三部分组成：

1. 请求行
2. 请求头
3. 请求正文

## 4.服务器处理请求并返回 HTTP 报文

- 服务器收到请求，根据 HTTP 请求的内容来决定如何获取相应的 HTML 文件
- 将得到的 HTML 文件发送给浏览器

### 4.1 HTTP 状态码

- 1xx：指示信息，表示请求已接收，继续处理
- 2xx：表示请求已被成功接收
- 3xx：重定向，要完成请求必须进行更进一步的操作。
  - 304：可以使用缓存的资源。
- 4xx：客户端错误，请求有语法错误或请求无法实现。
- 5xx：服务器端错误，服务器未能实现合法的请求。

## 5.浏览器解析渲染页面

- 浏览器还未完全接受 HTML 文件时便会开始渲染，显示网页
- 在执行 HTML 中代码时，根据需要，浏览器会继续请求图片，CSS，JavaScript 等文件。

### 5.1 浏览器加载页面渲染流程

1. 解析 HTML 文件生成 DOM 树
2. 解析 CSS 文件生成 CSSOM （CSS 对象模型）树
3. 整合 DOM 树  和 CSSOM ，生成渲染树
4. 布局阶段，为每个结点计算一个在屏幕上显示的坐标。
5. 绘制阶段，渲染引擎遍历渲染树，由用户界面后端层将每一个结点绘制出来。

这是一个渐进的过程，不必等到整个 HTML 文档解析完毕，就会开始构建渲染树和设置布局。在不断接收和处理来自网络的其余内容的同时，渲染引擎会将部分内容解析并渲染出来。

## 6.结束连接

- 客户端向服务器发送一个断开连接的请求
- 服务器收到请求后发送确认收到请求的信号
- 服务器向主机发送断开连接通知
- 客户端收到断开的通知后断开连接并反馈一个确认信号，服务器收到确认信号后断开连接。



